{"version":3,"sources":["Classes/Constants.js","Classes/TimerClass.js","Components/Toasts.js","Pages/PostsPage.js","Components/Modals/AuthModal.js","Components/Modals/TutorialModal.js","Help/API Key/0.png","Help/API Key/1.png","Help/API Key/2.png","Pages/SettingsPage.js","Icons/Kermit.svg","Components/Posts/PostComments.js","Pages/PostPage.js","Pages/PopularPostsPage.js","App.js","Classes/API.js","Components/Modals.js","Components/Tooltip.js","Icons/Chevron.svg","Components/ContextMenuHandler.js","Components/InlineLoading.js","Classes/Database.js","Components/Posts/Posts.js","Components/LinkWrapper.js","Components/General/Header.js","Classes/QueryManager.js","Classes/Hooks.js","Components/General/SearchField.js","Components/ErrorBoundary.js","Pages/SetsPage.js","Pages/Home.js","Components/Posts/TagItem.js","Components/TabsList.js","Components/Posts/Post.js","serviceWorker.js","index.js"],"names":["joinClassNames","final","i","arguments","length","Array","isArray","trim","download","uri","fetch","encodeURIComponent","then","res","blob","a","Object","assign","document","createElement","style","display","href","URL","createObjectURL","split","body","appendChild","click","window","revokeObjectURL","remove","catch","err","console","error","Toasts","showToast","getRandomKey","Math","random","toString","substr","formatBytes","bytes","decimals","k","dm","sizes","floor","log","pow","toFixed","toLocaleString","Timer","callback","duration","playAutomatically","this","remainingTime","resume","startTime","Date","now","clearTimeout","id","setTimeout","Toast","children","type","life","color","fixedTime","handleRemove","setClosing","React","useState","closing","timer","useMemo","progressBar","useRef","handleMouseEnter","pause","current","animationPlayState","handleMouseLeave","useEffect","handleFocus","handleBlur","addEventListener","hasFocus","removeEventListener","className","onMouseEnter","onMouseLeave","onClick","e","end","cursor","backgroundColor","ref","animationDuration","state","toasts","instance","horizontalStyle","verticalStyle","setState","additionalOptions","toast","key","filter","t","Component","createRef","PostsPage","search","searchPlaceholder","emptyPlaceholder","Header","App","userReady","Posts","AuthModal","signUpMode","setSignUpMode","busy","setBusy","events","handleSignUp","getElementsByTagName","emailField","passwordField","value","createUserWithEmailAndPassword","Database","auth","Modals","pop","location","hash","handleLogIn","signInWithEmailAndPassword","reload","message","code","bind","Fragment","placeholder","marginLeft","TutorialModal","title","ApiKeyTutorialModal","marginTop","src","ApiKeyHelp0","alt","ApiKeyHelp1","ApiKeyHelp2","ApiKeySection","saveUsername","target","userData","username","update","user","uid","_","merge","saveApiKey","apiKey","push","defaultValue","onBlur","SettingsPage","updateDeBouncer","debounce","SettingsRenderer","forceUpdate","saveDeBouncer","Settings","save","useReducer","x","hasSearch","entries","props","map","categoryName","formatCamelCase","name","setting","SettingField","resetValue","defaults","accentColors","primary","secondary","backgroundColors","tertiary","backgroundImage","url","brightness","min","max","step","blur","positionX","positionY","settings","camelCase","r","replace","charAt","toUpperCase","slice","setValueState","pickerRef","inputRef","newVal","resetButton","Tooltip","alignItems","onInput","currentTarget","borderColor","maxLength","_defs","_g","_excluded","_extends","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgKermit","_ref","svgRef","titleId","xmlns","xmlnsXlink","isolation","viewBox","width","height","clipPath","fill","fillOpacity","d","ForwardRef","PostComments","comments","setComments","useInterval","API","request","data","doc","DOMParser","parseFromString","html","getElementsByClassName","comment","dataset","commentId","userId","creatorId","creator","score","parseInt","isDeleted","querySelector","innerHTML","avatarPost","posts","timestamp","dateTime","InlineLoading","LinkWrapper","rating","cropped_url","onError","preview_url","dangerouslySetInnerHTML","__html","PostPage","post","setPostData","setFailedState","toggleFavorite","is_favorited","removeFavorite","favorite","vote","extend","file","our_score","up","down","fav_count","description","TabsList","tabs","tags","tc","reverse","category","tag","index","TagItem","md5","created_at","size","sources","formatDate","date","getUTCDate","getMonth","getFullYear","join","PopularPostsPage","setDate","valueAsDate","scale","lastSearch","QueryManager","get","PageElement","args","stack","Home","SetsPage","subscriptions","e621User","isMobile","useMediaQuery","query","onAuthStateChanged","commit","sets","localStorage","getItem","setItem","Handler","getElementById","setPosts","SetsList","instances","forEach","setSets","setFetchingState","endpoint","lastMadeRequest","login","api_key","sub","json","loginData","params","URLSearchParams","_client","restOptions","Promise","getEndpoint","response","postId","no_unvote","method","post_id","openModal","modal","closeModal","ImageModal","getSources","buttons","u","findIndex","f","full","_setIndex","nav","dir","setLoaded","setFailed","preview","scrollIntoView","setIndex","expanded","setExpandedState","loaded","useEventListener","dependencies","test","controls","loop","onLoad","openImageModal","options","onBackdropClick","onMouseDown","handleBackdropClick","zIndex","m","direction","visible","parentElement","classList","add","toLowerCase","ContextMenu","docClickEv","contains","close","activeWrapper","menu","open","ErrorBoundary","Wrapper","handleContextMenu","preventDefault","top","overrideY","clientY","left","overrideX","clientX","innerWidth","ReactDOM","createPortal","publicProps","position","object","output","exclusions","exclude","prevProps","prevState","snapshot","rect","getBoundingClientRect","transform","y","innerHeight","wrapperClassName","openOnClick","onContextMenu","Item","handleClick","stopPropagation","autoClose","icon","SubMenuItem","right","label","ChevronIcon","mount","ToggleItem","checked","Divider","config","authDomain","projectId","storageBucket","messagingSenderId","appId","app","initializeApp","getAuth","db","getFirestore","path","getDoc","exists","_snapshot","obj","_new","setDoc","serializeObject","updateDoc","set","lastPageChange","additionalTags","isFetching","setSearchQuery","setHash","cachedRequest","setCachedRequest","page","blacklist","setImmediate","_posts","p","documentElement","scrollTop","scrollHeight","pushHistory","tooltipMode","fromEntries","def","history","dispatchEvent","Event","delay","callInstantly","deps","interval","setInterval","clearInterval","eventType","init","TagTypes","tooltip","SearchField","focused","setFocused","autoCompleteEntries","setAutoCompleteEntries","delete","pushState","handleSearch","onFocus","onKeyDown","handleAutoCompleteEntryClick","selectionStart","selectionEnd","focus","autoCorrect","padding","categoryIcon","antecedent_name","opacity","post_count","errorInfo","moreInfo","componentStack","msg","showErrorInfo","renderError","instanceIndex","newSets","_sets","s","splice","shortname","NavigationButtons","hot","popular","favorites","upvoted","NavigationButtonsComponent","TagItemContextMenu","appendToSearch","subscribe","unsubscribe","tagInfo","active","Children","toArray","onChange","child","Post","sample","flags","previewImage","tooltipText","setTooltipText","tooltipSide","setTooltipSide","busyButtons","setBusyButtons","previewLoaded","setPreviewLoaded","Button","text","downloading","clear","b","openInNewTab","ext","artist","PostContextMenu","PostModalButtons","toggleSet","postIndex","post_ids","justifyContent","Boolean","hostname","match","render","StrictMode","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.d2fe8120.chunk.js","sourcesContent":["import Toasts from \"../Components/Toasts\";\r\n\r\nexport function joinClassNames() {\r\n    let final = \"\";\r\n\r\n    for (let i = 0; i < arguments.length; i++) {\r\n        switch (typeof(arguments[i])) {\r\n            case (Array.isArray(arguments[i]) && typeof(arguments[i][0]) === \"boolean\" && \"object\"):\r\n                if (arguments[i][0] === true)\r\n                    final += arguments[i][1];\r\n                else if (arguments[i][2])\r\n                    final += arguments[i][2];\r\n                break;\r\n\r\n            default:\r\n                final += arguments[i];\r\n                break;\r\n        }\r\n\r\n        final += \" \";\r\n    }\r\n\r\n    return final.trim();\r\n}\r\n\r\nexport function download(uri) {\r\n    return fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(uri)}`)\r\n        .then(res => res.blob())\r\n        .then(blob => {\r\n            const a = Object.assign(document.createElement(\"a\"), {\r\n                style: { display: \"none\" },\r\n                href: URL.createObjectURL(blob),\r\n                download: uri.split(\"/\")[uri.split(\"/\").length - 1]\r\n            });\r\n\r\n            document.body.appendChild(a);\r\n            a.click();\r\n\r\n            window.URL.revokeObjectURL(a.href);\r\n            a.remove();\r\n        })\r\n        .catch(err => (console.error(err), Toasts.showToast(\"Failed to save image!\", \"Failure\")));\r\n}\r\n\r\nexport function getRandomKey() { return Math.random().toString(36).substr(7); }\r\n\r\n/**\r\n * Converts a number of bytes into a user-readable string.\r\n * Totally not stolen from stackoverflow and tweaked because I've written this exact function 50 times and still can't remember how to do it because fuck math.\r\n * @param bytes\r\n * @param decimals\r\n * @returns {string}\r\n */\r\nexport function formatBytes(bytes, decimals = 2) {\r\n    if (bytes === 0) return \"N/A\";\r\n\r\n    const k = 1024;\r\n    const dm = decimals < 0 ? 0 : decimals;\r\n    const sizes = [\" bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\r\n\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n    return (bytes / Math.pow(k, i)).toFixed(dm).toLocaleString() + (sizes[i] ?? sizes[sizes.length - 1]);\r\n}","export default class Timer {\r\n    id;\r\n    startTime;\r\n    remainingTime;\r\n    callback;\r\n    duration;\r\n    \r\n    constructor(callback, duration, playAutomatically = true) {\r\n        this.callback = callback;\r\n        this.duration = duration;\r\n        this.remainingTime = duration;\r\n        \r\n        if (playAutomatically)\r\n            this.resume();\r\n    }\r\n    \r\n    resume() {\r\n        this.startTime = Date.now();\r\n        \r\n        clearTimeout(this.id);\r\n        this.id = setTimeout(this.callback, this.remainingTime);\r\n    }\r\n    \r\n    pause() {\r\n        clearTimeout(this.id);\r\n        this.remainingTime -= Date.now() - this.startTime;\r\n    }\r\n    \r\n    end() {\r\n        clearTimeout(this.id);\r\n        this.callback();\r\n    }\r\n}","import React from \"react\";\r\nimport \"./Toasts.scss\";\r\nimport { getRandomKey, joinClassNames } from \"../Classes/Constants\";\r\nimport Timer from \"../Classes/TimerClass\";\r\n\r\nexport function Toast({ children, type, life, remove, callback, color, fixedTime = false }) {\r\n\tconst handleRemove = () => {\r\n\t\tsetClosing(true);\r\n\r\n\t\tsetTimeout(remove, 500);\r\n\t};\r\n\t\r\n\tconst [closing, setClosing] = React.useState(false);\r\n\tconst timer = React.useMemo(() => new Timer(handleRemove, life * 1000, false), []);\r\n\tconst progressBar = React.useRef();\r\n\t\r\n\tconst handleMouseEnter = () => {\r\n\t\ttimer.pause();\r\n\t\tprogressBar.current.style.animationPlayState = \"paused\";\r\n\t};\r\n\t\r\n\tconst handleMouseLeave = () => {\r\n\t\ttimer.resume();\r\n\t\tprogressBar.current.style.animationPlayState = \"running\";\r\n\t};\r\n\t\r\n\tReact.useEffect(() => {\r\n\t\tconst handleFocus = () => !fixedTime && handleMouseLeave();\r\n\t\tconst handleBlur = () => !fixedTime && handleMouseEnter();\r\n\t\t\r\n\t\twindow.addEventListener(\"focus\", handleFocus);\r\n\t\twindow.addEventListener(\"blur\", handleBlur);\r\n\t\t\r\n\t\t(fixedTime || document.hasFocus()) && handleMouseLeave();\r\n\t\t\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener(\"focus\", handleFocus);\r\n\t\t\twindow.removeEventListener(\"blur\", handleBlur);\r\n\t\t};\r\n\t});\r\n\t\r\n\treturn (\r\n\t\t<div className={joinClassNames(\"Toast\", [closing, \"Closing\"], type)}\r\n\t\t\t onMouseEnter={fixedTime ? null : handleMouseEnter}\r\n\t\t\t onMouseLeave={fixedTime ? null : handleMouseLeave}\r\n\t\t\t onClick={callback ? e => { callback(e); timer.end(); } : () => { timer.end(); }}\r\n\t\t\t style={{ cursor: callback ? \"pointer\" : null, backgroundColor: color }}>\r\n\t\t\t{ children }\r\n\r\n\t\t\t<div className=\"ProgressBarContainer\">\r\n\t\t\t\t<div ref={progressBar} className=\"ProgressBar\" style={{ animationDuration: life + \"s\" }}/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default class Toasts extends React.Component {\r\n\tstatic instance;\r\n\tstatic ref = React.createRef();\r\n\t\r\n\tstate = { toasts: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\tToasts.instance = this;\r\n\t}\r\n\t\r\n\tstatic showToast(children, type = \"\", life = 5, additionalOptions = {}) {\r\n\t\tconst { callback = null, color = null, fixedTime = false } = additionalOptions;\r\n\t\t\r\n\t\tconst toast = React.createElement(Toast, {\r\n\t\t\tkey: getRandomKey(),\r\n\t\t\tchildren, type, life, color, fixedTime,\r\n\t\t\tremove: () => {\r\n\t\t\t\tthis.instance.setState({ toasts: this.instance.state.toasts.filter(t => t !== toast) });\r\n\t\t\t},\r\n\t\t\tcallback\r\n\t\t});\r\n\r\n\t\tthis.instance.setState({ toasts: [ ...this.instance.state.toasts, toast ] });\r\n\t\treturn toast;\r\n\t}\r\n\t\r\n\tget horizontalStyle() {\r\n\t\treturn \"Center\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionX) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Left\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Center\";\r\n\t\t// \tcase 2:\r\n\t\t// \t\treturn \"Right\";\r\n\t\t// }\r\n\t}\r\n\t\r\n\tget verticalStyle() {\r\n\t\treturn \"Bottom\";\r\n\t\t\r\n\t\t// switch (Settings.props.notifications.toasts.positionY) {\r\n\t\t// \tcase 0:\r\n\t\t// \t\treturn \"Top\";\r\n\t\t// \tcase 1:\r\n\t\t// \t\treturn \"Bottom\";\r\n\t\t// }\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div ref={Toasts.ref} className={joinClassNames(\"ToastsContainer\", this.horizontalStyle, this.verticalStyle)}>\r\n\t\t\t\t<div className={joinClassNames(\"ClearButton\", [!!this.state.toasts?.length, \"Visible\"])} onClick={() => this.setState({ toasts: [] })}>\r\n\t\t\t\t\t<u>Close all</u>\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t{ this.state.toasts }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./PostsPage.scss\";\r\nimport Posts from \"../Components/Posts/Posts\";\r\nimport Header from \"../Components/General/Header\";\r\nimport App from \"../App\";\r\n\r\nexport default function PostsPage({ search, searchPlaceholder, emptyPlaceholder = null }) {\r\n    return (\r\n        <div className=\"PostsPage\">\r\n            <Header searchPlaceholder={searchPlaceholder}/>\r\n            \r\n            { App.userReady && <Posts search={search} emptyPlaceholder={emptyPlaceholder}/> }\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport \"./AuthModal.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Modals\";\r\nimport Toasts from \"../Toasts\";\r\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword } from \"firebase/auth\";\r\nimport Database from \"../../Classes/Database\";\r\n\r\n// TODO add password reset functionality.\r\n\r\nexport default function AuthModal() {\r\n    const [signUpMode, setSignUpMode] = React.useState(false);\r\n    const [busy, setBusy] = React.useState(false);\r\n    const ref = React.useRef();\r\n    \r\n    // Create an events object.\r\n    const events = {\r\n        handleSignUp: () => {\r\n            if (busy) return;\r\n            \r\n            // Get the input fields.\r\n            const [emailField, passwordField, confirmPasswordField] = ref.current.getElementsByTagName(\"input\");\r\n            \r\n            // If the passwords don't match, throw an error to the user and return.\r\n            if (confirmPasswordField.value !== passwordField.value)\r\n                return Toasts.showToast(\"Passwords must match!\", \"Failure\");\r\n            // If the email doesn't exist, throw an error to the user and return.\r\n            if (!emailField.value.trim())\r\n                return Toasts.showToast(\"You must input an email address\", \"Failure\");\r\n            // If the password is empty, throw an error to the user and return.\r\n            if (!passwordField.value.trim())\r\n                return Toasts.showToast(\"You must input a password\", \"Failure\");\r\n            \r\n            // Set the busy state so users don't spam the API.\r\n            setBusy(true);\r\n            \r\n            // Create the user account.\r\n            createUserWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n                // Then navigate to the settings.\r\n                .then(() => (Modals.pop(), Toasts.showToast(\"Welcome to Sucralose!\", \"Success\"), window.location.hash = \"#settings\"))\r\n                // Catch any errors that may have occurred.\r\n                .catch(e => {\r\n                    Toasts.showToast(\"An unknown error has occured! Check console for details\", \"Failure\");\r\n                    console.error(e);\r\n                });\r\n        },\r\n        handleLogIn: () => {\r\n            if (busy) return;\r\n\r\n            // Get the input fields.\r\n            const [emailField, passwordField] = ref.current.getElementsByTagName(\"input\");\r\n            \r\n            // Set the busy state so users don't spam the API.\r\n            setBusy(true);\r\n            \r\n            // Attempt to log in.\r\n            signInWithEmailAndPassword(Database.auth, emailField.value, passwordField.value)\r\n                // Then reload the page because I'm lazy.\r\n                .then(() => (Modals.pop(), window.location.reload()))\r\n                // Catch any errors that may have occurred.\r\n                .catch(e => {\r\n                    let message = \"Unknown\";\r\n                    \r\n                    switch (e.code) {\r\n                        case \"auth/invalid-email\":\r\n                            message = \"Invalid email address\";\r\n                            break;\r\n                            \r\n                        case \"auth/user-not-found\":\r\n                            message = \"No user with this email found\";\r\n                            break;\r\n                            \r\n                        case \"auth/wrong-password\":\r\n                            message = \"Incorrect password\";\r\n                            break;\r\n                    }\r\n                    \r\n                    Toasts.showToast(`Failed to sign in! Reason - ${message}`, \"Failure\", 10);\r\n                    console.error(e);\r\n                });\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"AuthModal\" ref={ref}>\r\n            <Feather.X className=\"CloseButton\" onClick={Modals.pop.bind(Modals)}/>\r\n            \r\n            { signUpMode ? (\r\n                <React.Fragment>\r\n                    <div className=\"MainSection Flex\">\r\n                        <div className=\"HelpSection\">\r\n                            <div className=\"Title\">NOTE</div>\r\n\r\n                            <div>\r\n                                This is not your e621.net details.<br/>\r\n                                You will have the option to enter<br/>\r\n                                your e621.net username and API key<br/>\r\n                                in your settings after signing up.<br/>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"Fields\">\r\n                            <h3>Sign Up</h3>\r\n\r\n                            <div className=\"FieldContainer\">\r\n                                <input type=\"email\" placeholder=\"Email Address\"/>\r\n                            </div>\r\n\r\n                            <div className=\"FieldContainer\">\r\n                                <input type=\"password\" placeholder=\"Password\"/>\r\n                            </div>\r\n\r\n                            <div className=\"FieldContainer\">\r\n                                <input type=\"password\" placeholder=\"Confirm Password\"/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"FooterSection Flex\">\r\n                        <div className=\"Button\" onClick={() => setSignUpMode(false)}>\r\n                            <Feather.LogIn/>\r\n                            <div>Log In</div>\r\n                        </div>\r\n\r\n                        <div className=\"Button\" style={{ marginLeft: \"auto\" }} onClick={events.handleSignUp}>\r\n                            <Feather.UserCheck/>\r\n                            <div>Sign Up</div>\r\n                        </div>\r\n                    </div>\r\n                </React.Fragment>\r\n            ) : (\r\n                <React.Fragment>\r\n                    <div className=\"MainSection Flex\">\r\n                        <div className=\"HelpSection\">\r\n                            <div className=\"Title\">Why?</div>\r\n\r\n                            <div>\r\n                                Having an account ensures that your data<br/>\r\n                                stays consistent across browsers and devices,<br/>\r\n                                along with giving you access to useful features,<br/>\r\n                                without the security risks of storing data on your device.<br/>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"Fields\">\r\n                            <h3>Login</h3>\r\n                            \r\n                            <div className=\"FieldContainer\">\r\n                                <input type=\"email\" placeholder=\"Email Address\"/>\r\n                            </div>\r\n\r\n                            <div className=\"FieldContainer\">\r\n                                <input type=\"password\" placeholder=\"Password\"/>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"FooterSection Flex\">\r\n                        <div className=\"Button\" onClick={() => setSignUpMode(true)}>\r\n                            <Feather.UserPlus/>\r\n                            <div>Sign Up</div>\r\n                        </div>\r\n                        \r\n                        <div className=\"Button\" style={{ marginLeft: \"auto\" }}>\r\n                            <Feather.Key/>\r\n                            <div>Reset Password</div>\r\n                        </div>\r\n                        \r\n                        <div className=\"Button\" onClick={events.handleLogIn}>\r\n                            <Feather.LogIn/>\r\n                            <div>Log In</div>\r\n                        </div>\r\n                    </div>\r\n                </React.Fragment>\r\n            ) }\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport \"./TutorialModal.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport { Modals } from \"../Modals\";\r\n\r\nexport default function TutorialModal({ children, title = \"Help\" }) {\r\n    return (\r\n        <div className=\"TutorialModal\">\r\n            <div className=\"ModalHeader\">\r\n                <h2>{title}</h2>\r\n                \r\n                <Feather.X onClick={Modals.pop.bind(Modals)}/>\r\n            </div>\r\n            \r\n            <div className=\"ModalBody\">\r\n                { children }\r\n            </div>\r\n        </div>\r\n    );\r\n}","export default __webpack_public_path__ + \"static/media/0.e687b5f9.png\";","export default __webpack_public_path__ + \"static/media/1.cde179fe.png\";","export default __webpack_public_path__ + \"static/media/2.c54309b2.png\";","import React from \"react\";\r\nimport \"./SettingsPage.scss\";\r\nimport Header from \"../Components/General/Header\";\r\nimport { Modals } from \"../Components/Modals\";\r\nimport TutorialModal from \"../Components/Modals/TutorialModal\";\r\nimport Toasts from \"../Components/Toasts\";\r\nimport Database from \"../Classes/Database\";\r\nimport App from \"../App\";\r\nimport _ from \"lodash\";\r\nimport * as Feather from \"react-feather\";\r\n\r\nimport ApiKeyHelp0 from \"../Help/API Key/0.png\";\r\nimport ApiKeyHelp1 from \"../Help/API Key/1.png\";\r\nimport ApiKeyHelp2 from \"../Help/API Key/2.png\";\r\nimport Tooltip from \"../Components/Tooltip\";\r\nimport { getRandomKey } from \"../Classes/Constants\";\r\n\r\nfunction ApiKeyTutorialModal() {\r\n    return (\r\n        <TutorialModal>\r\n            <h3>\r\n                Your API key is <b style={{ color: \"var(--red)\" }}>NOT</b> your pasword.\r\n            </h3>\r\n            \r\n            <h4>\r\n                It is used to interface with the e621 API, safely and securely;\r\n            </h4>\r\n            \r\n            <h4>\r\n                however, you should refrain from revealing this API key to anyone, \r\n                as it gives them access to all of your content, and the ability to post and vote as you.\r\n            </h4>\r\n            \r\n            <h4>\r\n                If you do not trust Sucralose, all of the source is available on GitHub,\r\n                I recommend and encourage you to view and analyze the source code.\r\n            </h4>\r\n            \r\n            <p>\r\n                That being said, you may gain access to your API key by navigating \r\n                to <a href=\"https://e621.net/users/home\">https://e621.net/users/home</a> and \r\n                following the steps below.\r\n            </p>\r\n            \r\n            <p style={{ marginTop: 50 }}>\r\n                <h2>Step 1</h2>\r\n                After navigating to your home page (and signing in if necessary), \r\n                you'll want to navigate to <b>Manage API Access</b>.\r\n            </p>\r\n            <img src={ApiKeyHelp0} alt=\"Help\"/>\r\n\r\n            <p style={{ marginTop: 50 }}>\r\n                <h2>Step 2</h2>\r\n                Enter your password, and press <b>Submit</b>.\r\n            </p>\r\n            <img src={ApiKeyHelp1} alt=\"Help\"/>\r\n\r\n            <p style={{ marginTop: 50 }}>\r\n                <h2>Step 3</h2>\r\n                Copy the text under <b>API Key</b> to your clipboard.\r\n            </p>\r\n            <img src={ApiKeyHelp2} alt=\"Help\"/>\r\n\r\n            <p style={{ marginTop: 50 }}>\r\n                <h2>Step 4, Final</h2>\r\n                Now that you have the API key, simple enter your username and API key \r\n                into their respective fields in Sucralose.\r\n            </p>\r\n        </TutorialModal>\r\n    )\r\n}\r\n\r\nfunction ApiKeySection() {\r\n    const events = {\r\n        saveUsername: ({ target }) => {\r\n            if (target.value.trim() === App.userData?.username) return;\r\n            \r\n            if (target.length > 36)\r\n                return Toasts.showToast(\"Username is too long\", \"Failure\");\r\n            \r\n            Database.update({ username: target.value }, \"users\", App.user.uid)\r\n                .then(() => {\r\n                    Toasts.showToast(\"Username updated\", \"Success\");\r\n                    \r\n                    _.merge(App.userData, { username: target.value });\r\n                });\r\n        },\r\n        saveApiKey: ({ target }) => {\r\n            if (target.value.trim() === App.userData?.apiKey) return;\r\n            \r\n            if (target.length > 36)\r\n                return Toasts.showToast(\"Invalid API key\", \"Failure\");\r\n\r\n            Database.update({ apiKey: target.value }, \"users\", App.user.uid)\r\n                .then(() => {\r\n                    Toasts.showToast(\"API key updated\", \"Success\");\r\n\r\n                    _.merge(App.userData, { apiKey: target.value });\r\n                });\r\n        }\r\n    }\r\n    \r\n    return App.user && App.userReady ? (\r\n        <div className=\"Section ApiKey\">\r\n            <h1>E621 API Key</h1>\r\n\r\n            <u onClick={() => Modals.push(<ApiKeyTutorialModal/>)}>\r\n                What's this?\r\n            </u>\r\n\r\n            <div className=\"FieldContainer\">\r\n                <input className=\"Field\" placeholder=\"Username\"\r\n                       defaultValue={App.userData.username}\r\n                       onBlur={events.saveUsername}/>\r\n            </div>\r\n\r\n            <div className=\"FieldContainer\">\r\n                <input className=\"Field Confidential\" placeholder=\"API Key\"\r\n                       defaultValue={App.userData.apiKey}\r\n                       onBlur={events.saveApiKey}/>\r\n            </div>\r\n        </div>\r\n    ) : null;\r\n}\r\n\r\nexport default function SettingsPage() {\r\n    const updateDeBouncer = _.debounce(() => SettingsRenderer.forceUpdate(), 200);\r\n    const saveDeBouncer = _.debounce(Settings.save.bind(Settings), 2000);\r\n    \r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    SettingsPage.forceUpdate = forceUpdate;\r\n    \r\n    return (\r\n        <div className=\"SettingsPage\">\r\n            <Header hasSearch={false}/>\r\n            \r\n            <ApiKeySection/>\r\n            \r\n            { Object.entries(Settings.props).map(([categoryName, props]) => (\r\n                <div className=\"Section\" key={categoryName}>\r\n                    <h1>{formatCamelCase(categoryName)}</h1>\r\n                    \r\n                    { Object.entries(props).map(([name, setting]) => (\r\n                        <SettingField\r\n                            key={getRandomKey()}\r\n                            name={name}\r\n                            setting={setting}\r\n                            resetValue={Settings.defaults[categoryName][name].value}\r\n                            callback={value =>\r\n                                (Settings.props[categoryName][name].value = value, saveDeBouncer(), updateDeBouncer())}\r\n                        />\r\n                    )) }\r\n                </div>\r\n            )) }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport const Settings = new class Settings {\r\n    defaults = {\r\n        accentColors: {\r\n            primary: {\r\n                type: \"color\",\r\n                value: \"#7bb1bd\"\r\n            },\r\n            secondary: {\r\n                type: \"color\",\r\n                value: \"#BD7BA2\"\r\n            }\r\n        },\r\n        backgroundColors: {\r\n            primary: {\r\n                type: \"color\",\r\n                value: \"#2c3946\"\r\n            },\r\n            secondary: {\r\n                type: \"color\",\r\n                value: \"#364758\"\r\n            },\r\n            tertiary: {\r\n                type: \"color\",\r\n                value: \"#364758\"\r\n            }\r\n        },\r\n        backgroundImage: {\r\n            url: {\r\n                type: \"string\",\r\n                value: \"\",\r\n                placeholder: \"Example - https://c.tenor.com/Z6gmDPeM6dgAAAAC/dance-moves.gif\"\r\n            },\r\n            brightness: {\r\n                type: \"slider\",\r\n                min: 0, max: 100,\r\n                step: 1,\r\n                value: 100\r\n            },\r\n            blur: {\r\n                type: \"slider\",\r\n                min: 0, max: 25,\r\n                step: 0.5,\r\n                value: 0\r\n            },\r\n            positionX: {\r\n                type: \"slider\",\r\n                min: 0, max: 100,\r\n                step: 1,\r\n                value: 50\r\n            },\r\n            positionY: {\r\n                type: \"slider\",\r\n                min: 0, max: 100,\r\n                step: 1,\r\n                value: 50\r\n            }\r\n        }\r\n    };\r\n    \r\n    props = _.merge({ }, this.defaults);\r\n    \r\n    async save() {\r\n        _.merge(App.userData?.settings, this.props);\r\n\r\n        await Database.update(App.userData, \"users\", App.user.uid)\r\n            .then(() => Toasts.showToast(\"Settings updated on the database\"))\r\n            .catch(err => (console.error(err), Toasts.showToast(\"An unknown error occurred while saving settings\", \"Failure\")));\r\n    }\r\n}\r\n\r\nfunction formatCamelCase(camelCase) {\r\n    const r = camelCase.replace(/([A-Z])/g, \" $1\");\r\n\r\n    return r.charAt(0).toUpperCase() + r.slice(1);\r\n}\r\n\r\nexport function SettingField({ name, setting, resetValue, callback }) {\r\n    const [value, setValueState] = React.useState(setting.value);\r\n    const pickerRef = React.useRef();\r\n    const inputRef = React.useRef();\r\n    const setState = newVal => {\r\n        callback?.(newVal);\r\n        setValueState(newVal);\r\n        \r\n        if (pickerRef.current) pickerRef.current.value = newVal;\r\n        if (inputRef.current) inputRef.current.value = newVal;\r\n    };\r\n    \r\n    const resetButton = value !== resetValue && (\r\n        <div className=\"ResetButton\"\r\n             onClick={() => setState(resetValue)}>\r\n            <Feather.RotateCcw/>\r\n            \r\n            <Tooltip>Reset To Default</Tooltip>\r\n        </div>\r\n    );\r\n\r\n    switch (setting.type) {\r\n        default: return null;\r\n\r\n        case \"color\": return (\r\n            <div className=\"FieldContainer\">\r\n                <h4 className=\"FieldTitle\">{formatCamelCase(name)}</h4>\r\n\r\n                <div className=\"Flex\" style={{ alignItems: \"center\" }}>\r\n                    <input className=\"ColorPicker\" defaultValue={value}\r\n                           type=\"color\"\r\n                           ref={pickerRef}\r\n                           onInput={e => setState(e.currentTarget.value)}/>\r\n                    \r\n                    <input className=\"Field ColorField\" defaultValue={value}\r\n                           ref={inputRef}\r\n                           style={{ borderColor: value }}\r\n                           maxLength={64}\r\n                           onInput={e => setState(e.currentTarget.value)}/>\r\n                    \r\n                    {resetButton}\r\n                </div>\r\n            </div>\r\n        );\r\n        \r\n        case \"string\": return (\r\n            <div className=\"FieldContainer\">\r\n                <h4 className=\"FieldTitle\">{formatCamelCase(name)}</h4>\r\n                \r\n                <div className=\"Flex\" style={{ alignItems: \"center\" }}>\r\n                    <input className=\"Field\" defaultValue={value}\r\n                           placeholder={setting.placeholder}\r\n                           ref={inputRef} maxLength={128}\r\n                           onInput={e => setState(e.currentTarget.value)}/>\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n        case \"slider\": return (\r\n            <div className=\"FieldContainer\">\r\n                <h4 className=\"FieldTitle\">{formatCamelCase(name)} - {value}</h4>\r\n\r\n                <div className=\"Flex\" style={{ alignItems: \"center\" }}>\r\n                    <input className=\"Field ColorField\" defaultValue={value}\r\n                           type=\"range\"\r\n                           ref={inputRef}\r\n                           onInput={e => setState(e.currentTarget.value)}\r\n                           min={setting.min} max={setting.max}/>\r\n                    \r\n                    {resetButton}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport function SettingsRenderer() {\r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    SettingsRenderer.forceUpdate = forceUpdate;\r\n\r\n    const { props } = Settings;\r\n\r\n    return (\r\n        <style>\r\n            {`\r\n            \r\n\t\t\t:root {\r\n\t\t\t\t--primary-color: ${props.accentColors.primary.value};\r\n\t\t\t\t--secondary-color: ${props.accentColors.secondary.value};\r\n\t\t\t\t\r\n\t\t\t\t--primary-bg: ${props.backgroundColors.primary.value};\r\n\t\t\t\t--secondary-bg: ${props.backgroundColors.secondary.value};\r\n\t\t\t\t--tertiary-bg: ${props.backgroundColors.tertiary.value};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t`}\r\n            \r\n            { !!props.backgroundImage?.url?.value?.trim?.() && `\r\n                .AppBackground {\r\n                    background-image: url(\"${props.backgroundImage.url.value}\");\r\n                    background-position: ${props.backgroundImage.positionX.value}%\r\n                                         ${props.backgroundImage.positionY.value}%;\r\n                    \r\n                    filter: blur(${props.backgroundImage.blur.value || 0}px)\r\n                            brightness(${props.backgroundImage.brightness.value}%);\r\n                            \r\n                    opacity: 1;\r\n                }\r\n                \r\n                .Footer {\r\n                    background-color: rgba(0,0,0, 0.5);\r\n                    backdrop-filter: blur(7px);\r\n                }\r\n            ` }\r\n        </style>\r\n    );\r\n}","var _defs, _g;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgKermit(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    style: {\n      isolation: \"isolate\"\n    },\n    viewBox: \"0 0 1024 1024\",\n    width: \"1024pt\",\n    height: \"1024pt\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"clipPath\", {\n    id: \"_clipPath_VLhmLKF27nF926q38ytCl20StHRMDv8J\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    width: 1024,\n    height: 1024\n  })))), /*#__PURE__*/React.createElement(\"g\", {\n    clipPath: \"url(#_clipPath_VLhmLKF27nF926q38ytCl20StHRMDv8J)\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    width: 1024,\n    height: 1024,\n    style: {\n      fill: \"rgb(42,42,42)\"\n    },\n    fillOpacity: 0\n  }), _g || (_g = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 391.435 916.828 Q 471.605 721.151 545.738 636.285 C 619.871 551.418 594.377 545.715 537.688 472.589 C 480.998 399.462 436.719 312.918 387.409 291.45 L 391.435 264.614 Q 680.586 344.45 724.193 333.045 Q 515.548 293.462 449.131 264.614 C 382.713 235.766 383.049 223.355 396.802 209.602 C 410.555 195.849 517.226 135.134 572.574 125.07 Q 627.922 115.007 631.611 119.703 Q 718.826 81.128 751.029 161.298 Q 869.999 277.138 857.029 425.627 C 844.058 574.116 851.214 611.238 869.105 638.968 C 886.995 666.698 978.235 769.795 967.054 916.828 L 967.054 916.828 L 391.435 916.828 Z \",\n    fill: \"currentColor\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 546.384 682.698 C 540.011 678.17 349.479 687.059 264.612 657.205 Q 179.746 627.35 244.486 469.357 Q 327.843 456.275 401.473 260.041 L 174.714 113.788 Q 26.467 257.191 63.347 368.724 Q 84.145 431.62 159.954 457.281 Q 105.277 689.575 206.916 733.685 Q 308.555 777.796 500.764 772.597 Q 552.757 687.227 546.384 682.698 Z \",\n    fill: \"currentColor\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \" M 646.718 129.096 Q 670.87 129.096 653.427 150.564 Q 659.8 170.104 654.769 173.374 Q 649.737 176.645 644.035 154.589 Q 617.912 136.392 646.718 129.096 Z \",\n    fill: \"var(--primary-bg)\"\n  })))));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgKermit);\nexport default __webpack_public_path__ + \"static/media/Kermit.4ed5c4d0.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\r\nimport \"./PostComments.scss\";\r\nimport { useInterval } from \"../../Classes/Hooks\";\r\nimport API from \"../../Classes/API\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport { ReactComponent as Kermit } from \"../../Icons/Kermit.svg\";\r\nimport LinkWrapper from \"../LinkWrapper\";\r\nimport { joinClassNames } from \"../../Classes/Constants\";\r\n\r\n/* TODO\r\n\r\n    Add voting on comments.\r\n    Add timestamps.\r\n    Add the ability to post comments.\r\n    Handle deleted comments.\r\n\r\n */\r\n\r\nexport default function PostComments({ id }) {\r\n    const [comments, setComments] = React.useState(null);\r\n    \r\n    useInterval(() => {\r\n        API.request(`posts/${id}/comments`).then(data => {\r\n            const doc = new DOMParser().parseFromString(data.html, \"text/html\");\r\n            \r\n            setComments(\r\n                [...doc.getElementsByClassName(\"comment\")].map(comment => ({\r\n                    id: comment.dataset.commentId,\r\n                    userId: comment.dataset.creatorId,\r\n                    username: comment.dataset.creator,\r\n                    score: parseInt(comment.dataset.score),\r\n                    isDeleted: comment.dataset.isDeleted === \"true\",\r\n                    body: comment.querySelector(\".content > .body\")?.innerHTML,\r\n                    avatarPost: data.posts[comment.querySelector(\r\n                        \".avatar > .placeholder\"\r\n                    )?.dataset.id],\r\n                    timestamp: comment.querySelector(\"time\")?.dateTime\r\n                }))\r\n            );\r\n        });\r\n    }, 10000, true);\r\n    \r\n    return (\r\n        <div className=\"PostComments\">\r\n            { comments === null ? (\r\n                <InlineLoading/>\r\n            ) : (\r\n                comments.length === 0 ? (\r\n                    <div className=\"NoComments\">\r\n                        <h1>No comment.</h1>\r\n                        \r\n                        <Kermit className=\"Kermit\"/>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"Comments\">\r\n                        {comments.map(comment => (\r\n                            <div className=\"Comment\" key={comment.id}>\r\n                                <div className=\"UserSection\">\r\n                                    <div className=\"AvatarContainer\">\r\n                                        <LinkWrapper href={`#post/${comment.avatarPost?.id}`}>\r\n                                            <img\r\n                                                className={joinClassNames(\"Avatar\", [comment.avatarPost?.rating === \"e\", \"NSFW\"])}\r\n                                                src={comment.avatarPost?.cropped_url}\r\n                                                onError={({ target }) => target.src = comment.avatarPost?.preview_url}\r\n                                                alt=\"User Avatar\"\r\n                                            />\r\n                                        </LinkWrapper>\r\n                                    </div>\r\n                                </div>\r\n                                \r\n                                <div className=\"BodySection\">\r\n                                    <LinkWrapper href={`#user/${comment.userId}`}>\r\n                                        <div className=\"Username\">\r\n                                            {comment.username}\r\n                                        </div>\r\n                                    </LinkWrapper>\r\n                                    \r\n                                    <div\r\n                                        className=\"Body\"\r\n                                        dangerouslySetInnerHTML={{ __html: comment.body }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )\r\n            ) }\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport \"./PostPage.scss\";\r\nimport Header from \"../Components/General/Header\";\r\nimport API from \"../Classes/API\";\r\nimport * as Feather from \"react-feather\";\r\nimport TabsList from \"../Components/TabsList\";\r\nimport PostComments from \"../Components/Posts/PostComments\";\r\nimport TagItem from \"../Components/Posts/TagItem\";\r\nimport _ from \"lodash\";\r\nimport { formatBytes } from \"../Classes/Constants\";\r\n\r\nexport default function PostPage({ id }) {\r\n    const [post, setPostData] = React.useState(null);\r\n    const [failed, setFailedState] = React.useState(false);\r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    \r\n    React.useEffect(() => {\r\n        API.request(`posts/${id}`)\r\n            .then(post => post?.post ? setPostData(post.post) : setFailedState(true))\r\n            .catch(err => (console.error(err), setFailedState(true)));\r\n    }, []);\r\n    \r\n    const events = {\r\n        toggleFavorite: () => {\r\n            if (post.is_favorited)\r\n                // Remove the post from the favorites list.\r\n                API.removeFavorite(id).then(() => (post.is_favorited = false, forceUpdate()));\r\n            else\r\n                // Add the post to the favorites list.\r\n                API.favorite(id).then(() => (post.is_favorited = true, forceUpdate()));\r\n        },\r\n        vote: score =>\r\n            // Vote on the post.\r\n            API.vote(id, score).then(data => (_.extend(post.score, data), forceUpdate()))\r\n    };\r\n    \r\n    return (\r\n        <div className=\"PostPage\">\r\n            <Header/>\r\n            \r\n            { post ? (\r\n                <div className=\"PostBody\">\r\n                    <div className=\"ImageContainer\">\r\n                        <img className=\"Image\"\r\n                             src={post.file.url}\r\n                             alt=\"Post Image\"/>\r\n                    </div>\r\n                    \r\n                    <div className=\"PostBodyMain\">\r\n                        <div\r\n                            className=\"Button\"\r\n                            style={{ color: post.score.our_score === 1 ? \"var(--primary-color)\" : null }}\r\n                            onClick={events.vote.bind(null, 1)}\r\n                        >\r\n                            <Feather.ThumbsUp/>\r\n                            <div>{post.score.up}</div>\r\n                        </div>\r\n                        \r\n                        <div\r\n                            className=\"Button\"\r\n                            style={{ color: post.score.our_score === -1 ? \"var(--primary-color)\" : null }}\r\n                            onClick={events.vote.bind(null, -1)}\r\n                        >\r\n                            <Feather.ThumbsDown/>\r\n                            <div>{-post.score.down}</div>\r\n                        </div>\r\n\r\n                        <div\r\n                            className=\"Button\"\r\n                            style={{ color: post.is_favorited ? \"var(--red)\" : null }}\r\n                            onClick={events.toggleFavorite}\r\n                        >\r\n                            <Feather.Heart/>\r\n                            <div>{post.fav_count}</div>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    { post.description && (\r\n                        <div className=\"PostDescriptionContainer Flex\">\r\n                            <div className=\"PostDescription\">\r\n                                {post.description}\r\n                            </div>\r\n                        </div>\r\n                    ) }\r\n                    \r\n                    <TabsList tabs={[\"Comments\", \"Tags\", \"Details\"]}>\r\n                        <PostComments id={id}/>\r\n                        \r\n                        <div className=\"TagsList\">\r\n                            {Object.keys(post.tags).filter(tc => post.tags[tc].length).reverse().map(category => (\r\n                                <div className=\"TagCategory\" key={category}>\r\n                                    <h2>{category} - {post.tags[category].length}</h2>\r\n                                    \r\n                                    <div className=\"Tags\">\r\n                                        {post.tags[category].map((tag, index) => (\r\n                                            <TagItem key={index}>\r\n                                                {tag}\r\n                                            </TagItem>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        \r\n                        <div className=\"PostDetails Flex\">\r\n                            <div>\r\n                                <div className=\"Entry\">\r\n                                    <h2>Post ID</h2>\r\n                                    <div>#{id}</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Post MD5 Hash</h2>\r\n                                    <div>{post.file.md5}</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Creation Date</h2>\r\n                                    <div>{post.created_at}</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Size</h2>\r\n                                    <div>{formatBytes(post.file.size)}</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Width</h2>\r\n                                    <div>{post.file.width} pixels</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Height</h2>\r\n                                    <div>{post.file.height} pixels</div>\r\n                                </div>\r\n\r\n                                <div className=\"Entry\">\r\n                                    <h2>Sources</h2>\r\n                                    <div>{\r\n                                        post.sources.map((src, i) => (\r\n                                            <div key={i} style={{ marginTop: 10 }}>\r\n                                                <a href={src}>\r\n                                                    {src}\r\n                                                </a>\r\n                                            </div>\r\n                                        ))\r\n                                    }</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </TabsList>\r\n                </div>\r\n            ) : (\r\n                failed ? (\r\n                    <div/>\r\n                ) : (\r\n                    <div/>\r\n                )\r\n            ) }\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport \"./PostsPage.scss\";\r\nimport Posts from \"../Components/Posts/Posts\";\r\nimport Header from \"../Components/General/Header\";\r\nimport App from \"../App\";\r\n\r\nfunction formatDate(date) {\r\n    return [date.getUTCDate(), date.getMonth() + 1, date.getFullYear()].join(\"-\");\r\n}\r\n\r\nexport default function PopularPostsPage() {\r\n    const [date, setDate] = React.useState(formatDate(new Date()));\r\n    \r\n    return (\r\n        <div className=\"PostsPage\">\r\n            <Header hasSearch={false}/>\r\n            \r\n            <div className=\"DatePicker\">\r\n                <h2>Date</h2>\r\n                \r\n                <input type=\"date\" ref={e => e && !e.value ? e.valueAsDate = new Date() : null}\r\n                       onInput={e => setDate(formatDate(new Date(e.target.value)))}/>\r\n            </div>\r\n\r\n            { App.userReady && <Posts request={[\"explore/posts/popular\", { date, scale: \"day\" }]}/> }\r\n        </div>\r\n    )\r\n}","import React from \"react\";\nimport { useMediaQuery } from \"react-responsive\";\nimport \"./App.scss\";\nimport { Modals } from \"./Components/Modals\";\nimport HomePage from \"./Pages/Home\";\nimport Toasts from \"./Components/Toasts\";\nimport { joinClassNames } from \"./Classes/Constants\";\nimport ContextMenu from \"./Components/ContextMenuHandler\";\nimport PostsPage from \"./Pages/PostsPage\";\nimport Posts from \"./Components/Posts/Posts\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport Database from \"./Classes/Database\";\nimport AuthModal from \"./Components/Modals/AuthModal\";\nimport SettingsPage, { Settings, SettingsRenderer } from \"./Pages/SettingsPage\";\nimport QueryManager from \"./Classes/QueryManager\";\nimport PostPage from \"./Pages/PostPage\";\nimport API from \"./Classes/API\";\nimport _ from \"lodash\";\nimport SetsList, { SetsPage } from \"./Pages/SetsPage\";\nimport PopularPostsPage from \"./Pages/PopularPostsPage\";\nimport TutorialModal from \"./Components/Modals/TutorialModal\";\n\n/* TODO \n\n\tAdd an option to set a custom background.\n\tAdd popular page https://e621.net/explore/posts/popular\n\tPut all to-do on README.md\n\tFix the order of favorites posts.\n\tAdd a list for blacklist and subscriptions.\n\tAdd a quick blacklist toggle menu.\n\n */\n\nlet lastSearch = QueryManager.get(\"search\") ?? \"\";\nwindow.addEventListener(\"popstate\", () => {\n\tconst search = QueryManager.get(\"search\") ?? \"\";\n\tif (lastSearch !== search && document.getElementById(\"searchField\")) {\n\t\tPosts.instance?.setPosts([]);\n\t\tSetsList.instances?.forEach(instance => instance.setSets([ ]));\n\t\tdocument.getElementById(\"searchField\").value = search;\n\n\t\tlastSearch = search;\n\t}\n\t\n\tApp.forceUpdate?.();\n\tPosts.instance?.setFetchingState(true);\n\tSetsList.instances?.forEach(instance => instance.setFetchingState(true));\n});\n\nfunction PageElement() {\n\t// Store the formatted hash in a variable.\n\tconst [hash, ...args] = (window.location.hash\n\t\t.split(/#\\/?/)[1] ?? \"\")\n\t\t.split(\"?\")[0]\n\t\t.split(\"/\");\n\t\n\t// If the user is ready but not logged in, open the auth modal.\n\tif (App.userReady && !App.user && ~[\"subscriptions\", \"favorites\", \"settings\"].indexOf(hash)) {\n\t\t// Make sure the modal is not already open.\n\t\tif (Modals.instance?.state?.stack?.length === 0) {\n\t\t\tModals.push(<AuthModal/>);\n\t\t}\n\t}\n\t\n\t// Set the app hash value.\n\tApp.hash = hash;\n\t\n\t// Zhu Li, do the thing!\n\tswitch (hash) {\n\t\tdefault: return <HomePage/>;\n\t\tcase \"posts\":\n\t\t\treturn <PostsPage searchPlaceholder=\"Search posts...\"/>;\n\t\tcase \"post\":\n\t\t\treturn <PostPage id={args[0]}/>;\n\t\tcase \"hot\":\n\t\t\treturn <PostsPage search=\"order:rank\" searchPlaceholder=\"Search hot posts...\"/>;\n\t\tcase \"popular\":\n\t\t\treturn <PopularPostsPage/>;\n\t\tcase \"sets\":\n\t\t\treturn <SetsPage/>;\n\t\tcase \"subscriptions\":\n\t\t\treturn <PostsPage search={\n\t\t\t\t\t\t\t\t(App.userData?.subscriptions?.length\n\t\t\t\t\t\t\t\t\t? App.userData.subscriptions.map(tag => `~${tag}`)\n\t\t\t\t\t\t\t\t\t: [\"____\"]).join(\" \")}\n\t\t\t\t\t\t\t  searchPlaceholder=\"Search subscriptions...\"\n\t\t\t\t\t\t\t  emptyPlaceholder={(\n\t\t\t\t\t\t\t  \t<>\n\t\t\t\t\t\t\t\t\t<h2>No subscribed posts found.</h2>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\tYou can subscribe to tags by right clicking on them and pressing \"Subscribe.\"\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t  )}/>;\n\t\tcase \"favorites\":\n\t\t\treturn <PostsPage search={`favoritedby:${App.e621User?.name}`}\n\t\t\t\t\t\t\t  searchPlaceholder=\"Search favorites...\"\n\t\t\t\t\t\t\t  emptyPlaceholder={(\n\t\t\t\t\t\t\t  \t<>\n\t\t\t\t\t\t\t\t\t<h2>No favorited posts found.</h2>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\tCheck your search tags, as they also apply to favorites.\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t  )}/>;\n\t\tcase \"upvoted\":\n\t\t\treturn <PostsPage search={`votedup:${App.e621User?.name}`}\n\t\t\t\t\t\t\t  searchPlaceholder=\"Search upvoted posts...\"\n\t\t\t\t\t\t\t  emptyPlaceholder={(\n\t\t\t\t\t\t\t\t  <>\n\t\t\t\t\t\t\t\t\t  <h2>No upvoted posts found.</h2>\n\n\t\t\t\t\t\t\t\t\t  <div>\n\t\t\t\t\t\t\t\t\t\t  Check your search tags, as they also apply to upvotes.\n\t\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t  </>\n\t\t\t\t\t\t\t  )}/>;\n\t\tcase \"settings\":\n\t\t\treturn <SettingsPage/>;\n\t}\n}\n\nexport default function App() {\n\tconst isMobile = useMediaQuery({ query: \"(max-width: 1224px)\" });\n\tconst [, forceUpdate] = React.useReducer(x => x + 1, 0);\n\tApp.forceUpdate = forceUpdate;\n\tApp.userData = App.userData ?? { };\n\t\n\tReact.useEffect(() => {\n\t\tonAuthStateChanged(Database.auth, user => {\n\t\t\tif (user) {\n\t\t\t\t// Assign the user.\n\t\t\t\tApp.user = user;\n\t\t\t\t\n\t\t\t\tDatabase.get(\"users\", user.uid).then(async data => {\n\t\t\t\t\t// If the user's username is defined, get their e621 user data.\n\t\t\t\t\tif (data.username)\n\t\t\t\t\t\tApp.e621User = await API.request(`users/${data.username}`);\n\t\t\t\t\t\n\t\t\t\t\t// Assign Firebase data.\n\t\t\t\t\tApp.userData = _.extend({\n\t\t\t\t\t\tsubscriptions: [],\n\t\t\t\t\t\tsettings: { }\n\t\t\t\t\t}, data);\n\t\t\t\t\t\n\t\t\t\t\t// Assign e621 database data.\n\t\t\t\t\t_.extend(App.userData, {\n\t\t\t\t\t\tsets: data.username ? await API.request(\n\t\t\t\t\t\t\t\"post_sets\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcommit: \"Search\",\n\t\t\t\t\t\t\t\t\"search[creator_name]\": data.username\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) : []\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// Set user ready state and force update.\n\t\t\t\t\tApp.userReady = true;\n\t\t\t\t\tApp.forceUpdate();\n\t\t\t\t\t\n\t\t\t\t\t// Apply settings\n\t\t\t\t\t_.merge(Settings.props, App.userData.settings);\n\t\t\t\t\tSettingsRenderer.forceUpdate();\n\t\t\t\t\tSettingsPage.forceUpdate?.();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tApp.userReady = true;\n\t\t\t\t\n\t\t\t\tif (!localStorage.getItem(\"hasPromptedLogin\")) {\n\t\t\t\t\tModals.push(<AuthModal/>);\n\t\t\t\t\t\n\t\t\t\t\tlocalStorage.setItem(\"hasPromptedLogin\", \"1\");\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// If the user is new to the site, display the V2 modal.\n\t\t\tif (!localStorage.getItem(\"v2\")) {\n\t\t\t\tModals.push(\n\t\t\t\t\t<TutorialModal title=\"Welcome to the new Sucralose!\">\n\t\t\t\t\t\t<h2>What's different?</h2>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tI've re-built the site from the ground up, with better code, performance, \n\t\t\t\t\t\t\tand most importantly, better device support.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tSome of the new features include the following:\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<div><b>Database!</b></div>\n\t\t\t\t\t\t\t\t\tI've added a Firebase database to the site, which will let you create \n\t\t\t\t\t\t\t\t\tan account and sync your data between devices and browsers.\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<div><b>Mobile support</b></div>\n\t\t\t\t\t\t\t\t\tMobile support was pretty bad in the previous release, but \n\t\t\t\t\t\t\t\t\tthis version was started with mobile in mind.\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<div><b>Better UI/UX</b></div>\n\t\t\t\t\t\t\t\t\tThis is of course an opinional thing, but the user interface and user \n\t\t\t\t\t\t\t\t\texperience has been redesigned for a friendlier experience.\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<div><b>Popular page</b></div>\n\t\t\t\t\t\t\t\t\tThis is an overlooked feature in e621, mostly because its UI is \n\t\t\t\t\t\t\t\t\tso outdated; but it has been incorporated into Sucralose with a \n\t\t\t\t\t\t\t\t\tlittle better interface.\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<div><b>Search everything, everywhere</b></div>\n\t\t\t\t\t\t\t\t\tThe previous version of Sucralose did not let you search hot, \n\t\t\t\t\t\t\t\t\tfavorites, sets, etc. All of this is fixed in this version.\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</TutorialModal>\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\tlocalStorage.setItem(\"v2\", \"1\");\n\t\t\t}\n\t\t});\n\t}, []);\n\n\treturn (\n\t\t<div className={joinClassNames(\"App\", isMobile ? \"Mobile\" : \"Desktop\")}>\n\t\t\t<div className=\"AppBackground\"/>\n\t\t\t\n\t\t\t<div className=\"Main\">\n\t\t\t\t<PageElement/>\n\t\t\t</div>\n\n\t\t\t<footer className=\"Footer\">\n\t\t\t\t<div><a href=\"https://feathericons.com/\">Icons License</a></div>\n\t\t\t\t<div className=\"Divider\"/>\n\t\t\t\t<div><a href=\"https://metalloriff.github.io/city-fog\">Default Theme</a></div>\n\t\t\t\t<div className=\"Divider\"/>\n\t\t\t\t<div><a href=\"https://metalloriff.github.io/sucralose-legacy\">Sucralose Legacy</a></div>\n\t\t\t\t<div className=\"Divider\"/>\n\t\t\t\t<div>Copyright © 2021-{new Date().getFullYear()} Metalloriff</div>\n\t\t\t\t<div className=\"Divider\"/>\n\t\t\t\t<div><a href=\"https://paypal.me/israelboone\">♥ Donate ♥</a></div>\n\t\t\t</footer>\n\n\t\t\t<Modals/>\n\t\t\t<Toasts/>\n\t\t\t<ContextMenu.Handler/>\n\t\t\t\n\t\t\t<SettingsRenderer/>\n\t\t</div>\n\t);\n}","import App from \"../App\";\r\nimport Toasts from \"../Components/Toasts\";\r\n\r\nexport default new class E621API {\r\n    endpoint = \"https://e621.net/\";\r\n    \r\n    get loginData() {\r\n        return {\r\n            login: App.userData.username,\r\n            api_key: App.userData.apiKey\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets a request-able URL to the E621 API endpoint.\r\n     * @param sub {string} The page to request.\r\n     * @param args The arguments to pass to the request as a string.\r\n     * @param json {boolean} Whether to request from the json endpoint.\r\n     * @returns {string} An endpoint URL.\r\n     */\r\n    getEndpoint(sub, args = {}, json = true) {\r\n        // Get the stored login data.\r\n        let login = this.loginData;\r\n        // If the login or api key is null, then clean the login object.\r\n        if (!login.login || !login.api_key) login = {};\r\n        \r\n        // Create the request params object.\r\n        const params = new URLSearchParams({\r\n            ...login,\r\n            ...args,\r\n            _client: \"Sucralose/2.0 by Metalloriff\"\r\n        });\r\n        \r\n        // Return the request string.\r\n        return `${this.endpoint}${sub}${json ? \".json?\" : \"?\"}${params}`;\r\n    }\r\n    \r\n    /**\r\n     * Make a request to the E621 API endpoint.\r\n     * @param sub {string} The page to request from the E621 API endpoint.\r\n     * @param args The arguments to pass to the request as a string.\r\n     * @param json {boolean} Whether to request from the json endpoint.\r\n     * @param restOptions The options argument to pass to the fetch request.\r\n     * @returns {Promise<any>} A promise that resolves when the request has been made.\r\n     */\r\n    async request(sub, args = {}, json = true, restOptions = {}) {\r\n        // Rate limit for requests made.\r\n        while (Date.now() - this.lastMadeRequest < 500)\r\n            await new Promise(r => setTimeout(r, 100));\r\n        // Set the last made request to the current time.\r\n        this.lastMadeRequest = Date.now();\r\n        \r\n        // Return the response object.\r\n        return await fetch(this.getEndpoint(sub, args, json), restOptions)\r\n            .then(response => json ? response.json() : response);\r\n    }\r\n\r\n    /**\r\n     * The last time a request was made to the E621 API endpoint.\r\n     * @type {number}\r\n     */\r\n    lastMadeRequest = -500;\r\n\r\n    #voting = { };\r\n\r\n    /**\r\n     * Handles voting/un-voting on a post.\r\n     * @param postId {number} The ID of the post.\r\n     * @param score {number | \"-1\" | \"1\"} The score to assign to the post.\r\n     * @returns {Promise<*>}\r\n     */\r\n    async vote(postId, score) {\r\n        // If the user is not signed in, throw an error and return.\r\n        if (!App.userData.username || !App.userData.apiKey)\r\n            return Toasts.showToast(\"You must be logged in to favorite posts\", \"Failure\");\r\n        \r\n        // If we're already trying to vote on this post, throw an error and return.\r\n        if (this.#voting[postId])\r\n            return Toasts.showToast(\"You're attempting to vote too quickly\", \"Failure\");\r\n        this.#voting[postId] = true;\r\n        \r\n        // Make the request to the E621 API.\r\n        return await this.request(\r\n            `posts/${postId}/votes`,\r\n            { score, no_unvote: false },\r\n            true,\r\n            { method: \"POST\" }\r\n        ).then(r => (delete this.#voting[postId], r));\r\n    }\r\n    \r\n    #favoriting = { };\r\n\r\n    /**\r\n     * Handles adding a post to the user's favorites.\r\n     * @param postId {number} The ID of the post to add.\r\n     * @returns {Promise<*>}\r\n     */\r\n    async favorite(postId) {\r\n        // If the user is not signed in, throw an error and return.\r\n        if (!App.userData.username || !App.userData.apiKey)\r\n            return Toasts.showToast(\"You must be logged in to favorite posts\", \"Failure\");\r\n        \r\n        // If we're already trying to favorite this post, throw an error and return.\r\n        if (this.#favoriting[postId])\r\n            return Toasts.showToast(\"You're attempting to favorite too quickly\", \"Failure\");\r\n        this.#favoriting[postId] = true;\r\n        \r\n        // Make the request to the E621 API.\r\n        return await this.request(\r\n            \"favorites\",\r\n            { post_id: postId },\r\n            true,\r\n            { method: \"POST\" }\r\n        ).then(r => (delete this.#favoriting[postId], r));\r\n    }\r\n\r\n    /**\r\n     * Handles deleting a post from the user's favorites.\r\n     * @param postId {number} The ID of the post to remove.\r\n     * @returns {Promise<*>}\r\n     */\r\n    async removeFavorite(postId) {\r\n        // If the user is not signed in, throw an error and return.\r\n        if (!App.userData.username || !App.userData.apiKey)\r\n            return Toasts.showToast(\"You must be logged in to favorite posts!\");\r\n\r\n        // If we're already trying to favorite this post, throw an error and return.\r\n        if (this.#favoriting[postId])\r\n            return Toasts.showToast(\"You're attempting to favorite too quickly\", \"Failure\");\r\n        this.#favoriting[postId] = true;\r\n        \r\n        // Make the request to the E621 API.\r\n        return await this.request(\r\n            `favorites/${postId}.json`,\r\n            { },\r\n            false,\r\n            { method: \"DELETE\" }\r\n        ).then(r => (delete this.#favoriting[postId], r));\r\n    }\r\n}","import React from \"react\";\r\nimport \"./Modals.scss\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\nimport Toasts from \"./Toasts\";\r\nimport InlineLoading from \"./InlineLoading\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport Tooltip from \"./Tooltip\";\r\nimport LinkWrapper from \"./LinkWrapper\";\r\nimport * as Feather from \"react-feather\";\r\nimport { useEventListener } from \"../Classes/Hooks\";\r\n\r\n/**\r\n * Pushes a component to the modal stack.\r\n * @deprecated Use Modals.push(modal) instead.\r\n * @param modal The React component modal.\r\n */\r\nexport function openModal(modal) {\r\n\tModals.push(modal);\r\n}\r\n\r\n/**\r\n * Close the last modal in the stack.\r\n * @deprecated Use Modals.pop() instead.\r\n */\r\nexport function closeModal() {\r\n\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n}\r\n\r\n/**\r\n * Copies the specified text to the clipboard\r\n * @param text The text to copy.\r\n * @returns {Promise<void>}\r\n */\r\nexport async function copyToClipboard(text) {\r\n\ttry {\r\n\t\tawait window.navigator.clipboard.writeText(text);\r\n\r\n\t\tToasts.showToast(<span><b>{text.length >= 100 ? text.substr(0, 100) + \"...\" : text}</b> copied to clipboard</span>, \"Success\");\r\n\t}\r\n\tcatch (e) {\r\n\t\topenStringModal({\r\n\t\t\ttitle: \"Failed To Copy\",\r\n\t\t\tdescription: \"Your browser does not support copying to clipboard, you can manually copy here.\",\r\n\t\t\tvalue: text\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// TODO update this\r\nexport function ImageModal({ url, getSources, buttons }) {\r\n\t// Get the sources or create a single-item array\r\n\tconst sources = typeof(getSources) === \"function\" ? getSources().filter(u => u) : [url];\r\n\t\r\n\tconst ref = React.useRef();\r\n\t\r\n\t// Create a state based on the index of the current url\r\n\tconst [index, _setIndex] = React.useState(sources.findIndex(f => f.full === url));\r\n\tfunction setIndex(index) {\r\n\t\t// We don't talk about this in my job interview.\r\n\t\tdocument.querySelector(`[src=\"${sources[index].preview}\"]`)?.scrollIntoView();\r\n\t\t\r\n\t\t_setIndex(index);\r\n\t}\r\n\t\r\n\t// Create a navigate function to handle safely navigating images\r\n\tconst nav = dir =>\r\n\t\tsources[index + dir]\r\n\t\t\t? (setLoaded(false), setFailed(false), setIndex(index + dir))\r\n\t\t\t: Toasts.showToast(\"No more images in this direction!\", \"Failure\");\r\n\t// Create an expanded state based on the serialized settings state\r\n\tconst [expanded, setExpandedState] = React.useState(true);\r\n\t\r\n\t// These are placeholders, I'm too lazy to add them\r\n\tconst [loaded, setLoaded] = React.useState(false);\r\n\tconst [failed, setFailed] = React.useState(false);\r\n\t\r\n\t// Handle keyboard navigation/controls.\r\n\tuseEventListener(\"keydown\", ({ key }) => {\r\n\t\tswitch (key) {\r\n\t\t\tcase \"Escape\": return Modals.pop();\r\n\t\t\tcase \"ArrowLeft\": return nav(-1);\r\n\t\t\tcase \"ArrowRight\": return nav(1);\r\n\t\t}\r\n\t}, { dependencies: [index] });\r\n\t\r\n\t// Render bender\r\n\treturn (\r\n\t\t<div className=\"ImageModal\" onClick={e => e.target === e.currentTarget && Modals.pop()}>\r\n\t\t\t<div className={joinClassNames(\"ImageContainer\", [expanded, \"Expanded\"])}>\r\n\t\t\t\t{ /\\.webm$/.test(sources[index].full) ? (\r\n\t\t\t\t\t<video src={sources[index].full} controls loop\r\n\t\t\t\t\t\t   onLoad={() => (setLoaded(true), setFailed(false))}\r\n\t\t\t\t\t\t   onError={() => (setLoaded(true), setFailed(true))}/>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<img src={sources[index].preview} alt=\"Preview failed to load\"\r\n\t\t\t\t\t\t\t style={{ display: loaded ? \"none\" : null }}/>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<img src={sources[index].full} alt=\"Image failed to load\"\r\n\t\t\t\t\t\t\t style={{ display: loaded ? null : \"none\" }}\r\n\t\t\t\t\t\t\t onLoad={() => (setLoaded(true), setFailed(false))}\r\n\t\t\t\t\t\t\t onError={() => (setLoaded(true), setFailed(true))}/>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Left\",\r\n\t\t\t\t\t[!sources.length || !index, \"Disabled\"])} onClick={() => nav(-1)}>\r\n\t\t\t\t\t<Feather.ChevronLeft/>\r\n\t\t\t\t\t<Tooltip>Previous Image</Tooltip>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"Divider\"/>\r\n\t\t\t\t\r\n\t\t\t\t{ buttons ?? (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div className=\"Button\" onClick={() => (setExpandedState(!expanded))}>\r\n\t\t\t\t\t\t\t{ expanded ? <Feather.Minimize/> : <Feather.Maximize/> }\r\n\t\t\t\t\t\t\t<Tooltip>{expanded ? \"Compress\" : \"Expand\"}</Tooltip>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t\t\t<Feather.Clipboard/>\r\n\t\t\t\t\t\t\t<Tooltip>Copy URL</Tooltip>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<LinkWrapper className=\"Button\" style={{ display: \"block\", color: \"white\" }}\r\n\t\t\t\t\t\t\t\t\t href={sources[index].full}>\r\n\t\t\t\t\t\t\t<Feather.ExternalLink/>\r\n\t\t\t\t\t\t\t<Tooltip>Open In New Tab</Tooltip>\r\n\t\t\t\t\t\t</LinkWrapper>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) }\r\n\r\n\t\t\t\t<div className=\"Divider\"/>\r\n\t\t\t\t\r\n\t\t\t\t<div className={joinClassNames(\"Button Arrow Right\",\r\n\t\t\t\t\t[!sources.length || index + 1 >= sources.length, \"Disabled\"])} onClick={() => nav(1)}>\r\n\t\t\t\t\t<Feather.ChevronRight/>\r\n\t\t\t\t\t<Tooltip>Next Image</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\n/**\r\n * Pushes an image modal to the modal stack.\r\n * @param url The URI for the image to focus.\r\n * @param getSources? An option callback function that returns an array of URIs.\r\n */\r\nexport function openImageModal(url, getSources = null, options = { }) {\r\n\tModals.push(<ImageModal url={url} getSources={getSources} {...options}/>);\r\n}\r\n\r\n/**\r\n * Displays a two-choice modal to the user.\r\n * @param title\r\n * @param description\r\n * @param yesText\r\n * @param noText\r\n * @param yesColor\r\n * @param noColor\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function openBoolModal({\r\n\t  title = \"\",\r\n\t  description = \"\",\r\n\t  yesText = \"Yes\",\r\n\t  noText = \"No\",\r\n\t  yesColor = \"#ff6666\",\r\n\t  noColor = \"\"\r\n}) {\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<div className=\"BoolModal PrimaryBg\">\r\n\t\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }}/>\r\n\t\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }}/>\r\n\r\n\t\t\t\t<div className=\"Footer\">\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(false)} style={{ backgroundColor: noColor }}>{noText}</div>\r\n\t\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => resolve(true)} style={{ backgroundColor: yesColor }}>{yesText}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t});\r\n\t\r\n\tModals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Displays a string choice modal to the user.\r\n * @param options\r\n * @returns {Promise<string | null>}\r\n */\r\nexport async function openStringModal(options = {}) {\r\n\tconst { async = false } = options;\r\n\r\n\tconst response = await new Promise(resolve => {\r\n\t\tModals.push(\r\n\t\t\t<StringModal resolve={resolve} {...options}/>\r\n\t\t);\r\n\t});\r\n\r\n\t!async && Modals.pop();\r\n\r\n\treturn response;\r\n}\r\n\r\nexport class Modals extends React.Component {\r\n\tstatic instance;\r\n\r\n\t/**\r\n\t * Pushes a component to the modal stack.\r\n\t * @param modal The React component modal.\r\n\t */\r\n\tstatic push(modal) {\r\n\t\tthis.instance.setState({ stack: [...this.instance.state.stack, modal] });\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the last modal in the stack.\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tstatic async pop() {\r\n\t\t// Destructure the instance state\r\n\t\tconst { stack, closing } = this.instance.state;\r\n\t\tconst modal = stack[stack.length - 1];\r\n\t\t\r\n\t\t// If there is nothing to close, return\r\n\t\tif (!stack.length || !modal) return;\r\n\t\t\r\n\t\t// Push the modal to the closing state, activating the transition\r\n\t\tthis.instance.setState({ closing: [...closing, modal] });\r\n\t\t\r\n\t\t// Wait for the transition\r\n\t\tawait new Promise(r => setTimeout(r, 150));\r\n\t\t\r\n\t\t// Set the new state, removing the modal from both stack states\r\n\t\tthis.instance.setState({\r\n\t\t\tstack: this.instance.state.stack.filter(m => m !== modal),\r\n\t\t\tclosing: this.instance.state.closing.filter(m => m !== modal)\r\n\t\t});\r\n\t}\r\n\r\n\tstate = { stack: [], closing: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Assign the static instance variable\r\n\t\tModals.instance = this;\r\n\t}\r\n\r\n\thandleBackdropClick(e) {\r\n\t\t// Ensure that we're actually clicking the modal background\r\n\t\tif (e.target !== e.currentTarget) return;\r\n\r\n\t\t// If the modal has an on backdrop click prop, run it and return\r\n\t\tconst { stack } = this.state;\r\n\t\tif (stack[stack.length - 1] && typeof(stack[stack.length - 1].props?.onBackdropClick) === \"function\")\r\n\t\t\treturn stack[stack.length - 1].props.onBackdropClick();\r\n\t\t\r\n\t\t// K I L L\r\n\t\tModals.pop().catch(console.error.bind(console, \"Failed to pop modal!\"));\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { stack, closing } = this.state;\r\n\t\t\r\n\t\treturn (\r\n\t\t\t<div className={\"ModalStack\" + (stack.length > closing.length ? \" Active\" : \"\")}>\r\n\t\t\t\t{ stack.map((modal, id) => (\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t<div className={\"ModalContainer\" +\r\n\t\t\t\t\t\t\t (~closing.indexOf(modal) || id < stack.length - 1 ? \" Closing\" : \"\")}\r\n\t\t\t\t\t\t\t key={id}\r\n\t\t\t\t\t\t\t onMouseDown={this.handleBackdropClick.bind(this)}\r\n\t\t\t\t\t\t\t style={{ zIndex: id * 10 }}>{ modal }</div>\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t)) }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function StringModal(props) {\r\n\tconst { title = \"\", description = \"\", yesText = \"Confirm\", noText = \"Cancel\", yesColor = \"\", noColor = \"\", value = \"\", onChange = null, rich = false, resolve, id } = props;\r\n\tconst [no, setNoState] = React.useState(false);\r\n\tconst [yes, setYesState] = React.useState(false);\r\n\t\r\n\treturn (\r\n\t\t<div className=\"StringModal PrimaryBg\">\r\n\t\t\t<div className=\"Title\" dangerouslySetInnerHTML={{ __html: title }}/>\r\n\t\t\t<div className=\"Description\" dangerouslySetInnerHTML={{ __html: description }}/>\r\n\t\t\t\r\n\t\t\t<input id={id} className=\"Field TertiaryBg\" defaultValue={value} onChange={onChange}/>\r\n\r\n\t\t\t<div className=\"Footer\">\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(null), setNoState(true))} style={{ backgroundColor: noColor }}>{ no ? <InlineLoading/> : noText }</div>\r\n\t\t\t\t<div className=\"Button TertiaryBg\" onClick={() => (resolve(document.getElementById(id).value), setYesState(true))} style={{ backgroundColor: yesColor }}>{ yes ? <InlineLoading/> : yesText }</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport \"./Tooltip.scss\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nexport default function Tooltip({ children, direction = \"up\", className = \"\", color, style, onClick }) {\r\n    const [visible, setVisible] = React.useState(false);\r\n    const ref = React.useRef();\r\n    \r\n    React.useEffect(() => {\r\n        ref.current.parentElement.classList.add(\"HasTooltip\");\r\n        \r\n        return () => {\r\n            ref.current && ref.current.parentElement.classList.remove(\"HasTooltip\");\r\n        };\r\n    }, [ children, direction ]);\r\n    \r\n    return (\r\n        <div ref={ref} className={joinClassNames(\"TooltipContainer\", direction.toLowerCase(), [visible, \"Visible\"], className)} style={style} onClick={onClick}>\r\n            <div className=\"Tooltip\" style={{ backgroundColor: color }}>{ children }</div>\r\n            <div className=\"TooltipArrow\" style={{ backgroundColor: color }}/>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function DetachedTooltip({ children, direction = \"up\", className = \"\", color, style, onClick, parentRef }) {\r\n    const container = React.useMemo(() => document.getElementsByClassName(\"AppMain\")[0], []);\r\n    const [visible, setVisible] = React.useState(false);\r\n    const [styles, setStyles] = React.useState(null);\r\n    const ref = React.useRef();\r\n\r\n    React.useEffect(() => {\r\n        const parent = parentRef.current;\r\n        \r\n        const events = {\r\n            onMouseEnter: () => {\r\n                if (visible) return;\r\n                \r\n                const rect = parent.getBoundingClientRect();\r\n                const tooltipRect = ref.current.getBoundingClientRect();\r\n                \r\n                switch (direction) {\r\n                    case \"up\":\r\n                        setStyles({\r\n                            top: rect.y - rect.height - tooltipRect.height,\r\n                            left: rect.x + (rect.width / 2)\r\n                        });\r\n                        break;\r\n\r\n                    case \"left\":\r\n                        setStyles({\r\n                            top: rect.y - (rect.height / 2) + ((tooltipRect.height * 1.25) / 3),\r\n                            left: rect.x - (tooltipRect.width * 1.25)\r\n                        });\r\n                        break;\r\n                        \r\n                    case \"down\":\r\n                        setStyles({\r\n                            bottom: rect.y - (tooltipRect.height * 1.25),\r\n                            left: rect.x - ((tooltipRect.width * 1.25) / 2) + (rect.width / 2)\r\n                        });\r\n                        break;\r\n                        \r\n                    case \"right\":\r\n                        setStyles({\r\n                            top: rect.y - ((tooltipRect.height * 1.25) / 2) + (rect.height / 2),\r\n                            right: rect.x - tooltipRect.width - 5\r\n                        });\r\n                        break;\r\n                }\r\n                \r\n                setVisible(true);\r\n            },\r\n            onMouseLeave: () => setVisible(false)\r\n        };\r\n        \r\n        parent.addEventListener(\"mouseenter\", events.onMouseEnter);\r\n        parent.addEventListener(\"mouseleave\", events.onMouseLeave);\r\n        \r\n        return () => {\r\n            parent.removeEventListener(\"mouseenter\", events.onMouseEnter);\r\n            parent.removeEventListener(\"mouseleave\", events.onMouseLeave);\r\n        };\r\n    }, [ children, direction ]);\r\n\r\n    return ReactDOM.createPortal(\r\n        <div ref={ref} className={joinClassNames(\"TooltipContainer Detached\", direction.toLowerCase(), [visible, \"Visible\"], className)}\r\n             style={{ ...(styles ?? {}), ...(style ?? {}) }} onClick={onClick}>\r\n            <div className=\"Tooltip\" style={{ backgroundColor: color }}>{ children }</div>\r\n            <div className=\"TooltipArrow\" style={{ backgroundColor: color }}/>\r\n        </div>,\r\n        container\r\n    );\r\n}","export default __webpack_public_path__ + \"static/media/Chevron.c3ee4024.svg\";","import React, { createRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./ContextMenuHandler.scss\";\r\n\r\nimport ChevronIcon from \"../Icons/Chevron.svg\";\r\nimport ErrorBoundary from \"./ErrorBoundary\";\r\n\r\nfunction exclude(object, ...exclusions) {\r\n\tconst output = Object.assign({}, object);\r\n\r\n\tfor (const exclusion of exclusions) delete output[exclusion];\r\n\treturn output;\r\n}\r\n\r\nclass ContextMenu extends React.Component {\r\n\tref = createRef();\r\n\r\n\tdocClickEv = e => {\r\n\t\tif (this.ref.current && !this.ref.current.contains(e.target) && !document.getElementsByClassName(\"ContextMenu\")[0].contains(e.target)) {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tclose() {\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tdocument.addEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tdocument.removeEventListener(\"click\", this.docClickEv);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div className=\"ContextMenu\" {...this.props} ref={this.ref}>\r\n\t\t\t\t\t{ this.props.children }\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.Handler = class extends React.Component {\r\n\tstatic ref = createRef();\r\n\t\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={ContextMenu.Handler.ref} className=\"ContextMenuWrapper MainContextMenuContainer\">\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t);\r\n\t}\r\n};\r\n\r\nContextMenu.Wrapper = class extends React.Component {\r\n\tstate = { menu: null, open: false };\r\n\tref = createRef();\r\n\t\r\n\tget publicProps() {\r\n\t\treturn exclude(this.props, \"menu\", \"openOnClick\", \"wrapperClassName\", \"overrideX\", \"overrideY\");\r\n\t}\r\n\r\n\thandleContextMenu = e => {\r\n\t\tif (typeof(e.preventDefault) === \"function\")\r\n\t\t\te.preventDefault();\r\n\r\n\t\tif (ContextMenu.activeWrapper) {\r\n\t\t\tif (this.ref.current.contains(ContextMenu.activeWrapper.ref.current) && ContextMenu.activeWrapper.props.menu !== this.props.menu)\r\n\t\t\t\treturn;\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tContextMenu.activeWrapper = this;\r\n\t\t\r\n\t\tlet top = this.props.menu.props.overrideY?.() || e.clientY;\r\n\t\tlet left = this.props.menu.props.overrideX?.() || e.clientX;\r\n\t\t\r\n\t\twhile (left + 200 > window.innerWidth)\r\n\t\t\tleft -= 10;\r\n\t\t\r\n\t\tthis.setState({ menu: ReactDOM.createPortal(\r\n\t\t\t\t<div className=\"ContextMenuContainer SecondaryBg\" {...this.publicProps} style={{\r\n\t\t\t\t\tposition: \"fixed\",\r\n\t\t\t\t\ttop, left \r\n\t\t\t\t}}>{ this.props.menu }</div>, ContextMenu.Handler.ref.current), open: true });\r\n\t}\r\n\r\n\tasync componentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tif (ContextMenu.activeWrapper === this && !this.state.open)\r\n\t\t\tContextMenu.activeWrapper = null;\r\n\t\t\r\n\t\tif (this.state.open && this.ref.current) {\r\n\t\t\tconst [ menu ] = document.getElementsByClassName(\"ContextMenuContainer\");\r\n\t\t\tconst rect = menu.getBoundingClientRect();\r\n\t\t\t\r\n\t\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t\t: null;\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.props.menu ? (\r\n\t\t\t<ErrorBoundary>\r\n\t\t\t\t<div ref={this.ref} className={\"ContextMenuWrapper \" + (this.props.wrapperClassName || \"\")} onClick={this.props.openOnClick ? e => {\r\n\t\t\t\t\tif (typeof(e.target.onClick) === \"function\")\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.handleContextMenu(this.props.openOnClick());\r\n\t\t\t\t} : null}\r\n\t\t\t\t\t {...this.publicProps} onContextMenu={this.handleContextMenu}>\r\n\t\t\t\t\t{ this.props.children }\r\n\t\t\t\t\t\r\n\t\t\t\t\t<ErrorBoundary>\r\n\t\t\t\t\t\t{ this.state.open ? this.state.menu : null }\r\n\t\t\t\t\t</ErrorBoundary>\r\n\t\t\t\t</div>\r\n\t\t\t</ErrorBoundary>\r\n\t\t) : this.props.children;\r\n\t}\r\n}\r\n\r\nContextMenu.Item = class extends React.Component {\r\n\thandleClick = e => {\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\t\t\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem\" {...props} onClick={this.handleClick}>\r\n\t\t\t\t{ this.props.icon }\r\n\t\t\t\t\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nContextMenu.SubMenuItem = class extends React.Component {\r\n\tstate = { open: false };\r\n\r\n\thandleMouseEnter = () => {\r\n\t\tthis.setState({ open: true });\r\n\t}\r\n\r\n\thandleMouseLeave = () => {\r\n\t\tthis.setState({ open: false });\r\n\t}\r\n\r\n\thandleClick = e => {\r\n\t\tif (e.target !== e.currentTarget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tif (this.props.onClick) {\r\n\t\t\tthis.props.onClick(this);\r\n\t\t}\r\n\t}\r\n\t\r\n\tmount(menu) {\r\n\t\tif (!menu) return;\r\n\t\tconst rect = menu.getBoundingClientRect();\r\n\r\n\t\tmenu.style.transform = rect.y + rect.height > window.innerHeight\r\n\t\t\t? `translateY(${window.innerHeight - (rect.y + rect.height) - 20}px)`\r\n\t\t\t: null;\r\n\t\t\r\n\t\tif (rect.x + rect.width > window.innerWidth) {\r\n\t\t\tmenu.style.left = \"unset\";\r\n\t\t\tmenu.style.right = \"100%\";\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.label;\r\n\t\tdelete props.icon;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem HasSubMenu\" {...props} onClick={this.handleClick} onMouseEnter={this.handleMouseEnter} onMouseLeave={this.handleMouseLeave}>\r\n\t\t\t\t{ this.props.icon }\r\n\t\t\t\t{ this.props.label } <img className=\"ContextSubMenuChevron\" src={ChevronIcon}/>\r\n\t\t\t\t{ this.state.open ? (\r\n\t\t\t\t\t<div className=\"ContextMenuContainer SubMenuContainer SecondaryBg\" ref={this.mount}>\r\n\t\t\t\t\t\t<div className=\"ContextMenu SubMenu\">\r\n\t\t\t\t\t\t\t{ this.props.children }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : null }\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.ToggleItem = class extends React.Component {\r\n\tstate = { checked: false };\r\n\r\n\tcallback = () => {\r\n\t\tif (ContextMenu.activeWrapper && this.props.autoClose) {\r\n\t\t\tContextMenu.activeWrapper.setState({ menu: null, open: false });\r\n\t\t}\r\n\r\n\t\tconst checked = !this.state.checked;\r\n\r\n\t\tif (this.props.callback) {\r\n\t\t\tthis.props.callback(checked);\r\n\t\t}\r\n\r\n\t\tthis.setState({ checked });\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setState({ checked: this.props.checked });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst props = Object.assign({}, this.props);\r\n\r\n\t\tdelete props.autoClose;\r\n\t\tdelete props.callback;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuItem ToggleItem\" {...props} onClick={this.callback}>\r\n\t\t\t\t<div className={\"ToggleBox\" + (this.state.checked ? \" Checked\" : \"\")}>\r\n\t\t\t\t\t{ this.state.checked ? (<div className=\"ToggleBoxTick\"/>) : null }\r\n\t\t\t\t</div>\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nContextMenu.Divider = class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"ContextMenuDivider\" {...this.props}/>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default ContextMenu;","import React from \"react\";\r\nimport \"./InlineLoading.scss\";\r\n\r\nexport default function InlineLoading() {\r\n    return (\r\n        <div className=\"InlineLoadingContainer\">\r\n            <div className=\"Dot A\"/>\r\n            <div className=\"Dot B\"/>\r\n            <div className=\"Dot C\"/>\r\n        </div>\r\n    )\r\n}","import { initializeApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getFirestore, doc, getDoc, setDoc, updateDoc } from \"firebase/firestore\";\r\n\r\nconst config = {\r\n    apiKey: \"AIzaSyDmojC5Kl5vtST4vIyW81UfCrR6B18HnKw\",\r\n    authDomain: \"sucralose-74a13.firebaseapp.com\",\r\n    projectId: \"sucralose-74a13\",\r\n    storageBucket: \"sucralose-74a13.appspot.com\",\r\n    messagingSenderId: \"43887129209\",\r\n    appId: \"1:43887129209:web:7d607e00a979144af85aa8\"\r\n};\r\n\r\n// Long story short, I fucking hate the new Firebase API. (V9)\r\n// This is my attempt at at least making it tolerable.\r\nexport default new class Database {\r\n    app = initializeApp(config);\r\n    auth = getAuth();\r\n    db = getFirestore();\r\n    \r\n    async get(...path) {\r\n        const ref = doc(this.db, ...path);\r\n        const snapshot = await getDoc(ref);\r\n        if (!snapshot.exists()) return null;\r\n        \r\n        return {\r\n            _ref: ref,\r\n            _snapshot: snapshot,\r\n            id: snapshot.id,\r\n            ...snapshot.data()\r\n        };\r\n    }\r\n    \r\n    serializeObject(obj) {\r\n        const _new = { ...obj };\r\n        \r\n        delete _new._ref;\r\n        delete _new._snapshot;\r\n        delete _new.id;\r\n        \r\n        return _new;\r\n    }\r\n    \r\n    async set(data, ...path) {\r\n        return await setDoc(doc(this.db, ...path), this.serializeObject(data))\r\n            .catch(e => console.error(`Error setting doc data at \"${path.join(\"/\")}\"\\n${e.stack}`));\r\n    }\r\n    \r\n    async update(data, ...path) {\r\n        // TODO writing on error is very unsafe. Don't do that.\r\n        return await updateDoc(doc(this.db, ...path), this.serializeObject(data))\r\n            .catch(() => this.set(data, ...path))\r\n            .catch(e => console.error(`Error updating doc data at \"${path.join(\"/\")}\"\\n${e.stack}`));\r\n    }\r\n}","import React from \"react\";\r\nimport \"./Posts.scss\";\r\nimport API from \"../../Classes/API\";\r\nimport { joinClassNames } from \"../../Classes/Constants\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport Post from \"./Post\";\r\nimport { useEventListener } from \"../../Classes/Hooks\";\r\nimport QueryManager from \"../../Classes/QueryManager\";\r\nimport * as Feather from \"react-feather\";\r\nimport App from \"../../App\";\r\n\r\nlet lastPageChange = Date.now();\r\nexport default function Posts({ search: additionalTags, emptyPlaceholder = null, request = null }) {\r\n    const [posts, setPosts] = React.useState([]);\r\n    const [isFetching, setFetchingState] = React.useState(true);\r\n    const [search, setSearchQuery] = React.useState(\"\");\r\n    const [hash, setHash] = React.useState(window.location.hash);\r\n    const [cachedRequest, setCachedRequest] = React.useState(request);\r\n    \r\n    Posts.instance = {\r\n        posts, setPosts,\r\n        isFetching, setFetchingState\r\n    };\r\n    \r\n    React.useEffect(() => {\r\n        const query = new URLSearchParams(window.location.search);\r\n        const page = query.get(\"page\") || 1;\r\n        const tags = [\r\n            document.getElementById(\"searchField\")?.value,\r\n            additionalTags,\r\n            ...(App.userData?.blacklist ?? []).map(tag => `-${tag}`)\r\n        ].join(\" \");\r\n        \r\n        if (cachedRequest !== request) {\r\n            setFetchingState(true);\r\n            setCachedRequest(request);\r\n        }\r\n        \r\n        isFetching && setImmediate(() => {\r\n            API.request(\r\n                ...(request ?? [\r\n                    \"posts\",\r\n                    { tags, page }\r\n                ])\r\n            ).then(data => {\r\n                setFetchingState(false);\r\n                \r\n                // This entire function should be abolished.\r\n                const _posts =\r\n                    tags === search &&  window.location.hash === hash && !request\r\n                        ? [...posts, ...data.posts]\r\n                        : data.posts;\r\n                \r\n                setPosts(\r\n                    _posts.filter(\r\n                        (post, index) =>\r\n                            _posts.findIndex(p => p && p.id === post.id) === index\r\n                    )\r\n                );\r\n                \r\n                setSearchQuery(tags);\r\n                setHash(window.location.hash);\r\n            });\r\n        });\r\n    }, [isFetching, request]);\r\n    \r\n    // Handle infinite scrolling.\r\n    useEventListener(\"scroll\", () => {\r\n        if (Date.now() - lastPageChange < 2000 || isFetching || !posts?.length) return;\r\n        \r\n        const target = document.documentElement;\r\n        \r\n        if (target.scrollTop >= target.scrollHeight - window.innerHeight - 100) {\r\n            QueryManager.set(\"page\", parseInt(QueryManager.get(\"page\", 1)) + 1, {\r\n                pushHistory: false\r\n            });\r\n            \r\n            lastPageChange = Date.now();\r\n        }\r\n    }, { dependencies: [isFetching, posts, request] });\r\n    \r\n    return (\r\n        <div className=\"Posts\">\r\n            <h2 className=\"PageLabel\">{App.hash}</h2>\r\n            \r\n            { !isFetching && !posts?.length && (\r\n                <div className=\"NoPosts\">\r\n                    <div className=\"Placeholder\">{emptyPlaceholder ?? (\r\n                        <>\r\n                            <h2>No posts found.</h2>\r\n                            \r\n                            <div>\r\n                                Check your search tags, and ensure you've made no typos.\r\n                            </div>\r\n                        </>\r\n                    )}</div>\r\n                    \r\n                    <Feather.Frown/>\r\n                </div>\r\n            ) }\r\n            \r\n            <div className=\"Items\">\r\n                { posts?.map(post => <Post post={post} key={post.id}/>) }\r\n            </div>\r\n            \r\n            <div className={joinClassNames(\"FetchingStateModal\", [isFetching, \"Active\"])}>\r\n                <InlineLoading/>\r\n            </div>\r\n        </div>\r\n    );\r\n}","import React from \"react\";\r\nimport \"./LinkWrapper.scss\";\r\n\r\nexport default class extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<a className=\"LinkWrapper\" {...this.props}>\r\n\t\t\t\t{ this.props.children }\r\n\t\t\t</a>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./Header.scss\";\r\nimport SearchField from \"./SearchField\";\r\nimport { NavigationButtonsComponent } from \"../../Pages/Home\";\r\n\r\nexport default function Header({\r\n    searchPlaceholder = null,\r\n    hasSearch = true\r\n}) {\r\n    return (\r\n        <div className=\"Header\">\r\n            <div>\r\n                { hasSearch && <SearchField placeholder={searchPlaceholder}/> }\r\n                \r\n                <NavigationButtonsComponent className=\"NavigationButtons\"\r\n                                            tooltipMode/>\r\n            </div>\r\n        </div>\r\n    )\r\n}","export default new class QueryManager {\r\n    get query() {\r\n        return Object.fromEntries(\r\n            new URLSearchParams(window.location.search)\r\n        );\r\n    }\r\n    \r\n    get(key, def = null) {\r\n        return this.query[key] ?? def;\r\n    }\r\n    \r\n    set(key, value, options = {}) {\r\n        const {\r\n            pushHistory = true\r\n        } = options;\r\n        \r\n        const query = new URLSearchParams(window.location.search);\r\n        query.set(key, value);\r\n        \r\n        const url = window.location.href.replace(\r\n            window.location.search,\r\n            \"?\" + query.toString()\r\n        );\r\n\r\n        window.history[pushHistory ? \"pushState\" : \"replaceState\"]({ }, null, url);\r\n        window.dispatchEvent(new Event(\"popstate\"));\r\n    }\r\n}","import React from \"react\";\r\nimport App from \"../App\";\r\n\r\n/**\r\n * A setInterval hook for React components.\r\n * @param callback The function to call for the interval.\r\n * @param delay The delay between each call.\r\n * @param callInstantly Whether or not the callback will call instantly upon registering the hook.\r\n * @param deps The dependencies array for the hook.\r\n */\r\nexport function useInterval(callback, delay, callInstantly = false, deps = []) {\r\n    // Create side effect\r\n    React.useEffect(() => {\r\n        // Create interval based on delay\r\n        const interval = setInterval(callback, delay);\r\n        // If call instantly is truthy, run the callback\r\n        callInstantly && callback();\r\n\r\n        // On unmount, clear the interval\r\n        return () => clearInterval(interval);\r\n    }, deps);\r\n}\r\n\r\nexport function useMounted() {\r\n    const state = React.createRef(false);\r\n\r\n    React.useEffect(() => {\r\n        state.current = true;\r\n\r\n        return () => state.current = false;\r\n    }, []);\r\n\r\n    return state;\r\n}\r\n\r\nconst promiseCache = {};\r\nexport function usePromise(promise, useCache = true, deps = []) {\r\n    const [value, setValue] = React.useState(useCache ? promiseCache[promise] : null);\r\n    const isMounted = useMounted();\r\n\r\n    React.useEffect(() => {\r\n        !value && promise().then(v => (isMounted.current && setValue(v), promiseCache[promise] = v));\r\n    }, deps);\r\n\r\n    return value;\r\n}\r\n\r\nexport function useEventListener(eventType, callback, options = {}) {\r\n    const {\r\n        target = document,\r\n        dependencies = [],\r\n        init = false\r\n    } = options;\r\n\r\n    React.useEffect(() => {\r\n        target.addEventListener(eventType, callback);\r\n        init && callback();\r\n\r\n        return () => target.removeEventListener(eventType, callback);\r\n    }, dependencies);\r\n}\r\n\r\n// Sucralose-specific hooks\r\n\r\n","import React from \"react\";\r\nimport \"./SearchField.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport { joinClassNames } from \"../../Classes/Constants\";\r\nimport _ from \"lodash\";\r\nimport API from \"../../Classes/API\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport Posts from \"../Posts/Posts\";\r\nimport SetsList from \"../../Pages/SetsPage\";\r\n\r\n// Create the tag icon types.\r\nexport const TagTypes = {\r\n    0: { icon: <Feather.Hash/>, tooltip: \"General\" },\r\n    1: { icon: <Feather.Edit2/>, tooltip: \"Artist\" },\r\n    3: { icon: <Feather.Award/>, tooltip: \"Copyright\" },\r\n    4: { icon: <Feather.User/>, tooltip: \"Character\"  },\r\n    5: { icon: <Feather.Activity/>, tooltip: \"Species\" },\r\n    6: { icon: <Feather.AlertTriangle/>, tooltip: \"Invalid\" },\r\n    7: { icon: <Feather.AlignCenter/>, tooltip: \"Meta\" },\r\n    8: { icon: <Feather.BookOpen/>, tooltip: \"Lore\" }\r\n};\r\n\r\nexport default function SearchField({\r\n    placeholder = \"Search...\"\r\n}) {\r\n    const [focused, setFocused] = React.useState(false);\r\n    const [autoCompleteEntries, setAutoCompleteEntries] = React.useState([]);\r\n    const ref = React.useRef();\r\n    \r\n    const defaultValue = new URLSearchParams(window.location.search).get(\"search\");\r\n    SearchField.value = defaultValue;\r\n    \r\n    function search(value = null) {\r\n        // If a value was passed, set the value to that.\r\n        if (value) ref.current.value = value;\r\n        \r\n        // Get the query params as an object.\r\n        const params = new URLSearchParams(window.location.search);\r\n        // Set the search value of the query params.\r\n        params.set(\"search\", ref.current.value);\r\n        // Clear the page from the params.\r\n        params.delete(\"page\");\r\n        \r\n        window.history.pushState(\r\n            { },\r\n            null,\r\n            `?${params.toString()}${window.location.hash || \"#posts\"}`\r\n        );\r\n        \r\n        Posts.instance?.setPosts([]);\r\n        SetsList.instances?.forEach(instance => instance.setSets([ ]));\r\n        window.dispatchEvent(new Event(\"popstate\"));\r\n    }\r\n    \r\n    SearchField.handleSearch = search;\r\n    \r\n    // Create the events object.\r\n    const events = React.useMemo(() => ({\r\n        onFocus: () => setFocused(true),\r\n        onBlur: () => setFocused(false),\r\n        onKeyDown: e => e.key === \"Enter\" && search(),\r\n        onInput: _.debounce(async e => {\r\n            // Get the text content of the input.\r\n            const { value } = e.target;\r\n            SearchField.value = value;\r\n            \r\n            // Get the search string.\r\n            const search = value.split(/\\s/).slice(-1)[0].replace(/[-~*]/g, \"\");\r\n            // If the search string is empty, clear the state and return.\r\n            if (!search.trim()) return setAutoCompleteEntries([]);\r\n            \r\n            // Display a loading indicator.\r\n            setAutoCompleteEntries([null]);\r\n            \r\n            // Fetch the auto complete entries from the api.\r\n            const entries = await API.request(\"tags/autocomplete\", {\r\n                \"search[name_matches]\": search\r\n            });\r\n            \r\n            // Set the auto complete entries.\r\n            setAutoCompleteEntries(entries?.tags ?? entries);\r\n        }, 200)\r\n    }), []);\r\n    \r\n    // Create auto complete entry click handler.\r\n    function handleAutoCompleteEntryClick(tag) {\r\n        // Set the input text to the clicked tag name.\r\n        ref.current.value = [\r\n            // Get the text content of the input, excluding the last word.\r\n            ...ref.current.value.split(/\\s/).slice(0, -1),\r\n            // Append the tag name to the list of tags.\r\n            tag.name,\r\n            // And a little spacey.\r\n            \"\"\r\n        ].join(\" \");\r\n        \r\n        // Clear the auto complete entries.\r\n        setAutoCompleteEntries([]);\r\n        \r\n        // Wait for the next frame because JavaScript is shitting through the screen.\r\n        setImmediate(() => {\r\n            // Set the selection index to the end of the list.\r\n            ref.current.selectionStart =\r\n                ref.current.selectionEnd = ref.current.value.length;\r\n            \r\n            // Focus the input field element.\r\n            ref.current.focus();\r\n        });\r\n    }\r\n    \r\n    return (\r\n        <div className={joinClassNames(\"SearchFieldContainer\", [focused, \"Focused\"])}>\r\n            <input className=\"SearchField\" {...events} ref={ref}\r\n                   id=\"searchField\" autoCorrect=\"false\"\r\n                   defaultValue={defaultValue}\r\n                   placeholder={placeholder}/>\r\n            \r\n            <Feather.Search className=\"Button\" onClick={search.bind(null, null)}/>\r\n            \r\n            <div className=\"AutoCompleteContainer\">\r\n                {autoCompleteEntries.map(tag => tag === null\r\n                    ? (\r\n                        <div className=\"AutoCompleteEntry\" style={{ padding: 10 }}>\r\n                            <InlineLoading key={Date.now().toString(36)}/>\r\n                        </div>\r\n                    ) : (\r\n                        tag.categoryIcon = TagTypes[tag.category] ?? TagTypes[\"0\"],\r\n                        <div className=\"AutoCompleteEntry\" key={tag.id}\r\n                             onMouseDown={handleAutoCompleteEntryClick.bind(this, tag)}>\r\n                            <div className=\"IconContainer\">\r\n                                {tag.categoryIcon.icon}\r\n                                \r\n                                <Tooltip>{tag.categoryIcon.tooltip}</Tooltip>\r\n                            </div>\r\n                            \r\n                            { tag.antecedent_name ? (\r\n                                <div className=\"Title\">\r\n                                    {tag.name} <span style={{ opacity: 0.75 }}>({tag.antecedent_name})</span>\r\n                                </div>\r\n                            ) : <span className=\"Title\">{ tag.name }</span> }\r\n                            <span className=\"PostCount\">{tag.post_count} posts</span>\r\n                        </div>\r\n                    )\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}","import React from \"react\";\r\nimport \"./ErrorBoundary.scss\";\r\nimport { closeModal, openModal } from \"./Modals\";\r\n\r\nexport default class ErrorBoundary extends React.Component {\r\n    state = { error: null, errorInfo: null, moreInfo: false };\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n    \r\n    componentDidCatch(error, errorInfo) {\r\n        // console.error(error, errorInfo);\r\n        \r\n        this.setState({ error, errorInfo });\r\n    }\r\n    \r\n    showErrorInfo() {\r\n        const { error, errorInfo } = this.state;\r\n        \r\n        openModal(\r\n            <div className=\"ErrorInfoModal PrimaryBg\" onClick={() => closeModal()}>\r\n                <h1>{error.message}</h1>\r\n                { errorInfo.componentStack.split(\"\\n\").slice(0, 10).map((msg, i) => <h2 key={i}>{msg}</h2>) }\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    renderError() {\r\n        const { moreInfo } = this.state;\r\n        \r\n        return (\r\n            <div className=\"ErrorBoundaryHandler\">\r\n                <h1>There was an error with this component!</h1>\r\n                <h2>This is due to a plugin error or application error.</h2>\r\n                \r\n                <div className=\"ErrorBoundaryFooter\">\r\n                    <div className=\"ErrorBoundaryButton TertiaryBg\" onClick={() => this.showErrorInfo()}>More Info</div>\r\n                    <div className=\"ErrorBoundaryButton BackgroundDanger\" onClick={() => this.setState({ error: null })}>Retry</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        if (this.state.error)\r\n            return this.renderError();\r\n        \r\n        return this.props.children;\r\n    }\r\n}","import React from \"react\";\r\nimport \"./SetsPage.scss\";\r\nimport API from \"../Classes/API\";\r\nimport QueryManager from \"../Classes/QueryManager\";\r\nimport { useEventListener } from \"../Classes/Hooks\";\r\nimport Header from \"../Components/General/Header\";\r\nimport * as Feather from \"react-feather\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport InlineLoading from \"../Components/InlineLoading\";\r\nimport LinkWrapper from \"../Components/LinkWrapper\";\r\nimport TabsList from \"../Components/TabsList\";\r\nimport App from \"../App\";\r\n\r\nlet lastPageChange = Date.now();\r\nexport default function SetsList({ options = { } }) {\r\n    const [sets, setSets] = React.useState([]);\r\n    const [isFetching, setFetchingState] = React.useState(true);\r\n    const [search, setSearchQuery] = React.useState(\"\");\r\n    const [hash, setHash] = React.useState(window.location.hash);\r\n    \r\n    React.useEffect(() => {\r\n        if (!SetsList.instances) SetsList.instances = [];\r\n        \r\n        const instanceIndex = SetsList.instances.push({\r\n            sets, setSets,\r\n            isFetching, setFetchingState\r\n        });\r\n        \r\n        const page = QueryManager.get(\"page\") || 1;\r\n        const query = document.getElementById(\"searchField\").value;\r\n        \r\n        API.request(\r\n            \"post_sets\",\r\n            {\r\n                commit: \"Search\", page,\r\n                \"search[order]\": \"update\",\r\n                \"search[name]\": `*${query}*`,\r\n                ...options\r\n            }\r\n        ).then(newSets => {\r\n            setFetchingState(false);\r\n            if (!Array.isArray(newSets)) return;\r\n            \r\n            const _sets =\r\n                query === search && window.location.hash === hash\r\n                    ? [...sets, ...newSets]\r\n                    : newSets;\r\n            \r\n            setSets(\r\n                _sets.filter(\r\n                    (set, index) =>\r\n                        _sets.findIndex(s => s && s.id === set.id) === index\r\n                )\r\n            );\r\n            \r\n            setSearchQuery(query);\r\n            setHash(window.location.hash);\r\n        });\r\n        \r\n        return () => {\r\n            SetsList.instances.splice(instanceIndex, 1);\r\n        };\r\n    }, [isFetching]);\r\n\r\n    // Handle infinite scrolling.\r\n    useEventListener(\"scroll\", () => {\r\n        if (Date.now() - lastPageChange < 2000 || isFetching || !sets?.length) return;\r\n\r\n        const target = document.documentElement;\r\n\r\n        if (target.scrollTop >= target.scrollHeight - window.innerHeight - 100) {\r\n            QueryManager.set(\"page\", parseInt(QueryManager.get(\"page\", 1)) + 1, {\r\n                pushHistory: false\r\n            });\r\n\r\n            lastPageChange = Date.now();\r\n        }\r\n    }, { dependencies: [isFetching, sets] });\r\n    \r\n    return (\r\n        <div className=\"Sets\">\r\n            { !isFetching && !sets?.length && (\r\n                <div className=\"NoSets\">\r\n                    <div className=\"Placeholder\">\r\n                        <h2>No sets found.</h2>\r\n\r\n                        <div>\r\n                            Check your search tags, and ensure you've made no typos.\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Feather.Frown/>\r\n                </div>\r\n            ) }\r\n            \r\n            <div className=\"Items\">\r\n                { sets?.map(set => (\r\n                    <LinkWrapper key={set.id} href={`?search=set:${set.shortname}#posts`}>\r\n                        <div className=\"PostSet\">\r\n                            <div className=\"Head\">\r\n                                <div className=\"Title\">{set.name}</div>\r\n\r\n                                <div className=\"ShortName\">\r\n                                    ID - {set.shortname} | {set.id}\r\n                                </div>\r\n                            </div>\r\n\r\n                            { set.description && <div className=\"Description\">{set.description}</div> }\r\n                        </div>\r\n                    </LinkWrapper>\r\n                )) }\r\n            </div>\r\n\r\n            <div className={joinClassNames(\"FetchingStateModal\", [isFetching, \"Active\"])}>\r\n                <InlineLoading/>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function SetsPage() {\r\n    return (\r\n        <div className=\"SetsPage\">\r\n            <Header searchPlaceholder=\"Search sets...\"/>\r\n            \r\n            <TabsList tabs={[\"All\", \"Owned\", \"Subscribed\"]}>\r\n                <SetsList/>\r\n                \r\n                <SetsList options={{\r\n                    \"search[creator_name]\": App.userData?.username \r\n                }}/>\r\n\r\n                <div className=\"NoSets\">\r\n                    <div className=\"Placeholder\">\r\n                        <h2>Not yet added.</h2>\r\n\r\n                        <div>\r\n                            This feature isn't yet available.\r\n                        </div>\r\n                        \r\n                        <div>\r\n                            However, you can navigate to <a href=\"#subscriptions\">#subscriptions</a> and search <b>set:*</b>\r\n                        </div>\r\n                        \r\n                        <div>\r\n                            This will display all subscribed set posts.\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Feather.Frown/>\r\n                </div>\r\n            </TabsList>\r\n        </div>\r\n    )\r\n}","import React from \"react\";\r\nimport \"./Home.scss\";\r\nimport SearchField from \"../Components/General/SearchField\";\r\nimport * as Feather from \"react-feather\";\r\nimport LinkWrapper from \"../Components/LinkWrapper\";\r\nimport Tooltip from \"../Components/Tooltip\";\r\nimport { joinClassNames } from \"../Classes/Constants\";\r\nimport App from \"../App\";\r\n\r\nexport const NavigationButtons = {\r\n\tposts: { icon: <Feather.Grid/>, title: \"Latest Posts\" },\r\n\thot: { icon: <Feather.TrendingUp/>, title: \"Hot Posts\" },\r\n\tpopular: { icon: <Feather.BarChart2/>, title: \"Popular Posts\" },\r\n\tsets: { icon: <Feather.Layers/>, title: \"Browse Sets\" },\r\n\t\r\n\tsubscriptions: { icon: <Feather.Bell/>, title: \"Subscriptions\" },\r\n\tfavorites: { icon: <Feather.Heart/>, title: \"Favorites\" },\r\n\tupvoted: { icon: <Feather.ThumbsUp/>, title: \"Upvoted Posts\" },\r\n\tsettings: { icon: <Feather.Settings/>, title: \"Settings\" },\r\n};\r\n\r\nexport function NavigationButtonsComponent({ className, tooltipMode = false }) {\r\n\treturn (\r\n\t\t<div className={className || \"ButtonsContainer\"}>\r\n\t\t\t<div className=\"Left\">\r\n\t\t\t\t{ window.location.hash.length > 1 && (\r\n\t\t\t\t\t<LinkWrapper href=\"#\">\r\n\t\t\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t\t\t<Feather.Home/>\r\n\r\n\t\t\t\t\t\t\t<Tooltip direction=\"down\">Home</Tooltip>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</LinkWrapper>\r\n\t\t\t\t) }\r\n\t\t\t\t\r\n\t\t\t\t{[\"posts\", \"hot\", \"popular\", \"sets\"].map(path => (\r\n\t\t\t\t\t<LinkWrapper key={path} href={\"#\" + path}>\r\n\t\t\t\t\t\t<div className=\"Button\">\r\n\t\t\t\t\t\t\t{NavigationButtons[path].icon}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t{ tooltipMode ? (\r\n\t\t\t\t\t\t\t\t<Tooltip direction=\"down\">\r\n\t\t\t\t\t\t\t\t\t{NavigationButtons[path].title}\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t\t\t\t{NavigationButtons[path].title}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</LinkWrapper>\r\n\t\t\t\t))}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"Right\">\r\n\t\t\t\t{[\"subscriptions\", \"favorites\", \"upvoted\", \"settings\"].map(path => (\r\n\t\t\t\t\t<LinkWrapper key={path} href={\"#\" + path}>\r\n\t\t\t\t\t\t<div className={joinClassNames(\"Button HasTooltip\", [!App.user, \"Disabled\"])}>\r\n\t\t\t\t\t\t\t{NavigationButtons[path].icon}\r\n\r\n\t\t\t\t\t\t\t{ tooltipMode ? (\r\n\t\t\t\t\t\t\t\t<Tooltip direction=\"down\">\r\n\t\t\t\t\t\t\t\t\t{NavigationButtons[path].title}\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<div className=\"Title\">\r\n\t\t\t\t\t\t\t\t\t{NavigationButtons[path].title}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</LinkWrapper>\r\n\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default function Home() {\r\n\treturn (\r\n\t\t<div className=\"MainPage\">\r\n\t\t\t<div className=\"Head\">\r\n\t\t\t\t<h1>Sucralose!</h1>\r\n\t\t\t\t<div>A sweeter way to use <a href=\"https://e621.net\">e621</a>.</div>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<SearchField/>\r\n\t\t\t\r\n\t\t\t<NavigationButtonsComponent/>\r\n\t\t</div>\r\n\t);\r\n}","import React from \"react\";\r\nimport \"./TagItem.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport ContextMenu from \"../ContextMenuHandler\";\r\nimport SearchField from \"../General/SearchField\";\r\nimport Database from \"../../Classes/Database\";\r\nimport Toasts from \"../Toasts\";\r\nimport App from \"../../App\";\r\n\r\n/* TODO\r\n    \r\n    Replace tagInfo event with custom modal.\r\n    \r\n */\r\n\r\nexport default function TagItem({ children }) {\r\n    return (\r\n        <ContextMenu.Wrapper menu={<TagItemContextMenu tag={children}/>}>\r\n            <div className=\"TagItem\" onClick={() => SearchField.handleSearch(children)}>\r\n                {children}\r\n            </div>\r\n        </ContextMenu.Wrapper>\r\n    )\r\n}\r\n\r\nexport function TagItemContextMenu({ tag }) {\r\n    const events = {\r\n        appendToSearch: () =>\r\n            SearchField.handleSearch(SearchField.value.trim() + \" \" + tag),\r\n        subscribe: () => {\r\n            App.userData.subscriptions.push(tag);\r\n            \r\n            Database.update(App.userData, \"users\", App.user.uid)\r\n                .then(() => Toasts.showToast(<span>Added <b>{tag}</b> to subscribed tags</span>))\r\n                .catch(err => (console.error(err), Toasts.showToast(\"An unknown error occurred\", \"Failure\")));\r\n        },\r\n        unsubscribe: () => {\r\n            \r\n        },\r\n        blacklist: () => {\r\n            \r\n        },\r\n        tagInfo: () => {\r\n            window.open(`https://e621.net/wiki_pages/${tag}`, \"_blank\");\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <ContextMenu>\r\n            <ContextMenu.Item\r\n                autoClose\r\n                icon={<Feather.Plus/>}\r\n                onClick={events.appendToSearch}\r\n            >Append To Search Tags</ContextMenu.Item>\r\n            \r\n            <ContextMenu.Divider/>\r\n            \r\n            { App.userData && (\r\n                <React.Fragment>\r\n                    { ~App.userData.subscriptions.indexOf(tag.toLowerCase()) ? (\r\n                        <ContextMenu.Item\r\n                            autoClose\r\n                            icon={<Feather.BellOff/>}\r\n                            onClick={events.unsubscribe}\r\n                        >Unsubscribe</ContextMenu.Item>\r\n                    ) : (\r\n                        <ContextMenu.Item\r\n                            autoClose\r\n                            icon={<Feather.Bell/>}\r\n                            onClick={events.subscribe}\r\n                        >Subscribe</ContextMenu.Item>\r\n                    ) }\r\n\r\n                    <ContextMenu.Item\r\n                        autoClose\r\n                        icon={<Feather.EyeOff/>}\r\n                        onClick={events.blacklist}\r\n                    >Blacklist</ContextMenu.Item>\r\n\r\n                    <ContextMenu.Divider/>\r\n                </React.Fragment>\r\n            ) }\r\n            \r\n            <ContextMenu.Item\r\n                autoClose\r\n                icon={<Feather.HelpCircle/>}\r\n                onClick={events.tagInfo}\r\n            >Tag Info</ContextMenu.Item>\r\n        </ContextMenu>\r\n    );\r\n}","import React from \"react\";\r\nimport \"./TabsList.scss\";\r\n\r\nexport default class extends React.Component {\r\n\tstate = { active: null };\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setState({ active: 0 });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst children = React.Children.toArray(this.props.children);\r\n\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t<div className=\"TabsList\">\r\n\t\t\t\t\t{ this.props.tabs.map((title, index) => (\r\n\t\t\t\t\t\t<span key={title} className={\"TabItem\" + (index === this.state.active ? \" Active\" : \"\")} onClick={() => {\r\n\t\t\t\t\t\t\tthis.setState({ active: index });\r\n\r\n\t\t\t\t\t\t\tif (this.props.onChange) {\r\n\t\t\t\t\t\t\t\tthis.props.onChange(title, index, this);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t<span className=\"TabItemTitle\">{ title }</span>\r\n\t\t\t\t\t\t\t<div className=\"TabItemBorder\"/>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)) }\r\n\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t{ children.map((child, i) => (\r\n\t\t\t\t\t<div className=\"TabItem\" key={i}\r\n\t\t\t\t\t\t style={{ display: this.state.active === i ? \"block\" : \"none\" }}>\r\n\t\t\t\t\t\t{ child }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)) }\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}","import React from \"react\";\r\nimport \"./Post.scss\";\r\nimport * as Feather from \"react-feather\";\r\nimport Tooltip from \"../Tooltip\";\r\nimport { download, joinClassNames } from \"../../Classes/Constants\";\r\nimport Posts from \"./Posts\";\r\nimport { openImageModal } from \"../Modals\";\r\nimport API from \"../../Classes/API\";\r\nimport _ from \"lodash\";\r\nimport TagItem from \"./TagItem\";\r\nimport InlineLoading from \"../InlineLoading\";\r\nimport ContextMenu from \"../ContextMenuHandler\";\r\nimport Toasts from \"../Toasts\";\r\nimport App from \"../../App\";\r\n\r\n/**\r\n * The generic post component.\r\n * @param post {e621Post}\r\n * @constructor\r\n */\r\nexport default function Post({ post }) {\r\n    // De-structure the post object.\r\n    const {\r\n        id,\r\n        description,\r\n        sample,\r\n        file,\r\n        preview,\r\n        fav_count,\r\n        is_favorited,\r\n        score,\r\n        flags,\r\n        created_at,\r\n        rating,\r\n        tags\r\n    } = post;\r\n    \r\n    // Get the preview image URL without fail.\r\n    const previewImage = sample?.url ?? preview?.url ?? file?.url;\r\n    \r\n    // Create some states.\r\n    const [tooltipText, setTooltipText] = React.useState(\"\");\r\n    const [tooltipSide, setTooltipSide] = React.useState(\"left\");\r\n    const [busyButtons, setBusyButtons] = React.useState([]);\r\n    const [previewLoaded, setPreviewLoaded] = React.useState(false);\r\n    \r\n    // Create a force updater.\r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    \r\n    // Create the button component.\r\n    const Button = React.useMemo(() =>\r\n        ({ text, children, onClick, tooltipText, tooltipSide, className }) => {\r\n            const events = {\r\n                onClick,\r\n                onMouseEnter: () => (\r\n                    setTooltipText(tooltipText),\r\n                    setTooltipSide(tooltipSide ?? \"left\")\r\n                ),\r\n                onMouseLeave: () => setTooltipText(\"\")\r\n            };\r\n            \r\n            return (\r\n                <div className={joinClassNames(\"Button\", className)} {...events}>\r\n                    { ~busyButtons.indexOf(tooltipText)\r\n                        ? <Feather.Loader className=\"Spinner\"/>\r\n                        : children }\r\n                    \r\n                    <span>{text}</span>\r\n                </div>\r\n            );\r\n        }, [busyButtons]);\r\n    \r\n    // Create the events object.\r\n    let downloading = false;\r\n    const events = {\r\n        toggleFavorite: () => {\r\n            // Mark the button as busy.\r\n            setBusyButtons([ ...busyButtons, \"Favorite\" ]);\r\n            \r\n            // Create a clear event to unmark the button.\r\n            const clear = () => setBusyButtons(\r\n                busyButtons.filter(b => b !== \"Favorite\")\r\n            ); \r\n            \r\n            if (is_favorited)\r\n                // Remove the post from the favorites list.\r\n                API.removeFavorite(id).then(() => (post.is_favorited = false, clear()));\r\n            else\r\n                // Add the post to the favorites list.\r\n                API.favorite(id).then(() => (post.is_favorited = true, clear()));\r\n        },\r\n        vote: score => {\r\n            // Mark the button as busy.\r\n            setBusyButtons([ ...busyButtons, \"Upvote\", \"Downvote\" ]);\r\n            \r\n            // Create a clear event to unmark the button.\r\n            const clear = () => setBusyButtons(\r\n                busyButtons.filter(b => !~[\"Upvote\", \"Downvote\"].indexOf(b))\r\n            );\r\n            \r\n            // Vote on the post.\r\n            API.vote(id, score).then(data => (_.extend(post.score, data), clear()));\r\n        },\r\n        download: () => {\r\n            // Make sure the user isn't impatient.\r\n            if (downloading) return;\r\n            downloading = true;\r\n            \r\n            // Mark the button as busy.\r\n            setBusyButtons([ ...busyButtons, \"Download\" ]);\r\n            \r\n            // Create a clear event to unmark the button.\r\n            const clear = () => (setBusyButtons(\r\n                busyButtons.filter(b => b !== \"Download\")\r\n            ), downloading = false);\r\n            \r\n            // Download the post.\r\n            download(file.url).then(clear);\r\n        },\r\n        openInNewTab: () => window.open(`#post/${id}`, \"_blank\")\r\n    };\r\n\r\n    // Render me harder, daddy.\r\n    return previewImage && file.ext !== \"swf\" ? (\r\n        <div className=\"Post\">\r\n            <div className=\"PostHeader\">\r\n                Artist{tags.artist.length > 1 ? \"s\" : null}\r\n                <div className=\"Divider\"/>\r\n                { tags.artist.length\r\n                    ? tags.artist.map((artist, i) => (\r\n                        <TagItem key={i}>\r\n                            {artist}\r\n                        </TagItem>\r\n                    ))\r\n                    : (\r\n                        <span style={{ opacity: 0.65 }}>\r\n                            unknown\r\n                        </span>\r\n                    ) }\r\n            </div>\r\n            \r\n            { !previewLoaded && (\r\n                <div className=\"Preview Flex Loading\">\r\n                    <InlineLoading/>\r\n                </div>\r\n            ) }\r\n            \r\n            <ContextMenu.Wrapper menu={<PostContextMenu post={post}/>}>\r\n                <img src={previewImage} className=\"Preview\" alt=\"Preview\"\r\n                     onLoad={() => setPreviewLoaded(true)}\r\n                     onClick={() =>\r\n                         openImageModal(file.url, () =>\r\n                             Posts.instance.posts.map(post => ({\r\n                                 preview: post.sample?.url ?? post.preview?.url ?? post.file?.url,\r\n                                 full: post.file.url\r\n                             })), {\r\n                             buttons: <PostModalButtons post={post}/>\r\n                         })}/>\r\n            </ContextMenu.Wrapper>\r\n            \r\n            { file.ext === \"webm\" && (\r\n                <div className=\"VideoOverlay\">\r\n                    <Feather.Play/>\r\n                </div>\r\n            ) }\r\n            \r\n            <div className=\"PostFooter\" data-url={previewImage}>\r\n                { tooltipText && <div className={joinClassNames(\r\n                    \"FooterTooltip\", [tooltipSide === \"right\", \"RightSide\"]\r\n                )}>{tooltipText}</div> }\r\n                \r\n                <div className=\"VotesContainer\">\r\n                    <div className=\"Flex\">\r\n                        <Button text={score.up} tooltipText=\"Upvote\"\r\n                                className={score.our_score === 1 ? \"Active\" : \"\"}\r\n                                onClick={events.vote.bind(null, 1)}>\r\n                            <Feather.ThumbsUp/>\r\n                        </Button>\r\n                        \r\n                        <Button text={-score.down} tooltipText=\"Downvote\"\r\n                                className={score.our_score === -1 ? \"Active\" : \"\"}\r\n                                onClick={events.vote.bind(null, -1)}>\r\n                            <Feather.ThumbsDown/>\r\n                        </Button>\r\n                    </div>\r\n                    \r\n                    <div className=\"VotesTally\">\r\n                        <div className=\"UpVotes\" style={{\r\n                            width: ((score.up / (score.up + -score.down)) * 100) + \"%\"\r\n                        }}/>\r\n                    </div>\r\n                </div>\r\n\r\n                <Button text={fav_count} tooltipText=\"Favorite\"\r\n                        className={is_favorited ? \"Favorited\" : \"\"}\r\n                        onClick={events.toggleFavorite}>\r\n                    <Feather.Heart/>\r\n                </Button>\r\n                \r\n                <div style={{ marginLeft: \"auto\" }} className=\"Flex\">\r\n                    <Button tooltipText=\"Download\" tooltipSide=\"right\"\r\n                            onClick={events.download}>\r\n                        <Feather.Download/>\r\n                    </Button>\r\n                    \r\n                    <Button tooltipText=\"Open in new tab\" tooltipSide=\"right\"\r\n                            onClick={events.openInNewTab}>\r\n                        <Feather.ExternalLink/>\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    ) : null;\r\n}\r\n\r\nexport function PostContextMenu({ post }) {\r\n    const sets = App.userData?.sets ?? [];\r\n    \r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    \r\n    const events = {\r\n        toggleSet: async index => {\r\n            const set = App.userData?.sets[index];\r\n            const postIndex = set.post_ids.indexOf(post.id);\r\n            \r\n            if (postIndex !== -1) {\r\n                await API.request(\r\n                    `post_sets/${set.id}/remove_posts`,\r\n                    { \"post_ids[]\": post.id },\r\n                    true,\r\n                    { method: \"POST\" }\r\n                );\r\n\r\n                set.post_ids.splice(postIndex, 1);\r\n            }\r\n            else {\r\n                await API.request(\r\n                    `post_sets/${set.id}/add_posts`,\r\n                    { \"post_ids[]\": post.id },\r\n                    true,\r\n                    { method: \"POST\" }\r\n                );\r\n                \r\n                set.post_ids.push(post.id);\r\n            }\r\n        }\r\n    }\r\n    \r\n    return (\r\n        <ContextMenu>\r\n            <ContextMenu.SubMenuItem\r\n                label=\"Sets\"\r\n                icon={<Feather.Layers/>}\r\n            >\r\n                { !!sets.length && (\r\n                    <React.Fragment>\r\n                        { sets.map((set, index) => (\r\n                            <ContextMenu.Item\r\n                                className={joinClassNames(\"ContextMenuItem\", \"SetCmItem\",\r\n                                    [!!~set.post_ids.indexOf(post.id), \"Active\"])}\r\n                                key={set.id}\r\n                                icon={<Feather.Plus/>}\r\n                                onClick={async () => (await events.toggleSet(index), forceUpdate())}\r\n                            >{set.name}</ContextMenu.Item>\r\n                        )) }\r\n\r\n                        <ContextMenu.Divider/>     \r\n                    </React.Fragment>\r\n                ) }\r\n                \r\n                <ContextMenu.Item\r\n                    icon={<Feather.PlusSquare/>}\r\n                    onClick={() => Toasts.showToast(\r\n                        \"Not yet added - please do this in e621 for now\", \r\n                        \"Failure\"\r\n                    )}\r\n                >New Set</ContextMenu.Item>\r\n            </ContextMenu.SubMenuItem>\r\n        </ContextMenu>\r\n    );\r\n}\r\n\r\n/**\r\n * Please, do not look at this component.\r\n * I was lazy.\r\n * Leave me alone.\r\n * No stop.\r\n * Please don't scroll down.\r\n * @param post\r\n * @returns {JSX.Element}\r\n * @constructor\r\n */\r\nexport function PostModalButtons({ post }) {\r\n    const {\r\n        id,\r\n        is_favorited,\r\n        score,\r\n        fav_count,\r\n        file\r\n    } = post;\r\n    \r\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n    \r\n    const events = {\r\n        favorite: () => {\r\n            if (is_favorited)\r\n                // Remove the post from the favorites list.\r\n                API.removeFavorite(id).then(() => (post.is_favorited = false, forceUpdate()));\r\n            else\r\n                // Add the post to the favorites list.\r\n                API.favorite(id).then(() => (post.is_favorited = true, forceUpdate()));\r\n        },\r\n        vote: score =>\r\n            API.vote(id, score).then(data => (_.extend(post.score, data), forceUpdate())),\r\n        download: () => download(file.url)\r\n    }\r\n    \r\n    return (\r\n        <React.Fragment>\r\n            <div className=\"Button Flex\" style={{\r\n                alignItems: \"center\", justifyContent: \"center\",\r\n                color: score.our_score === 1 ? \"var(--primary-color)\" : null\r\n            }} onClick={events.vote.bind(null, 1)}>\r\n                <Feather.ThumbsUp/>\r\n                <div style={{ marginLeft: 5 }}>{score.up}</div>\r\n                \r\n                <Tooltip style={{ color: \"var(--txt-color)\" }}>Upvote</Tooltip>\r\n            </div>\r\n\r\n            <div className=\"Button Flex\" style={{\r\n                alignItems: \"center\", justifyContent: \"center\",\r\n                color: score.our_score === -1 ? \"var(--primary-color)\" : null\r\n            }} onClick={events.vote.bind(null, -1)}>\r\n                <Feather.ThumbsDown/>\r\n                <div style={{ marginLeft: 5 }}>{-score.down}</div>\r\n\r\n                <Tooltip style={{ color: \"var(--txt-color)\" }}>Downvote</Tooltip>\r\n            </div>\r\n\r\n            <div className=\"Button Flex\" style={{\r\n                alignItems: \"center\", justifyContent: \"center\",\r\n                color: is_favorited ? \"var(--red)\" : null\r\n            }} onClick={events.favorite}>\r\n                <Feather.Heart/>\r\n                <div style={{ marginLeft: 5 }}>{fav_count}</div>\r\n\r\n                <Tooltip style={{ color: \"var(--txt-color)\" }}>Favorite</Tooltip>\r\n            </div>\r\n\r\n            <div className=\"Button Flex\" style={{\r\n                alignItems: \"center\", justifyContent: \"center\"\r\n            }} onClick={events.download}>\r\n                <Feather.Download/>\r\n                <Tooltip style={{ color: \"var(--txt-color)\" }}>Download</Tooltip>\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App/>\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\nserviceWorker.unregister();"],"sourceRoot":""}